/*!
 * NeepRouter v0.1.0-alpha.5
 * (c) 2020-2021 Fierflame
 * @license MIT
 */
function t(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}let e,r,n,i,o,s,a,h,u,c;function l(t){({value:e,isValue:r,register:n,Error:i,label:o,createElementBase:s,createShellComponent:a,createDeliverComponent:h,addContextConstructor:u}=t)}function p(t,e,r){return"number"==typeof r&&Number.isInteger(r)?r<0?t.size+r:r:e}var f=a((function(t,e){const r=function(t,{delivered:e}){if(t.router instanceof T){const e=t.router;if(!(e instanceof T))return null;let r=p(e,0,t.depth);return r<0?null:{router:e,depth:r}}const r=e(c);if(!r)return null;const n=r.router;let i=p(n,r.depth+1,t.depth);return i<0?null:{router:n,depth:i}}(t,e);if(!r)return null;const{router:n}=r;let{depth:i}=r;const a=t.name||"default";for(let e=n._get(i);e;e=n._get(++i)){const{components:r}=e.route;if(!r)continue;const h=a in r?r[a]:void 0;if(h)return o({text:`{path=${e.path}}[${a}]`,color:"#987654"}),s(c,{value:{depth:i,router:n}},s(h,t))}return e.childNodes}),{name:"RouterView"}),d=a((function(t,e){var r;const{route:n,childNodes:i}=e;if(!n)return s("template",{},...i);let{to:o,append:a,replace:h,path:u,search:c,hash:l,query:p,alias:f,params:d}=t;function v(){n&&o&&(h?n.replace(o):n.push(o))}return o?"string"==typeof o&&(o={path:o}):o={path:u,search:c,hash:l,query:p,alias:f,params:d},a&&(o.append=!0),(null===(r=n.router.history)||void 0===r?void 0:r.link({...t,to:o},e,v))||s("span",{"on:click":v},...i)}),{name:"RouterLink"});function v(t){for(t=("/"+t).replace(/\/+(\/|$)/g,"$1");/[^/]+\/\.{2,}(\/|$)/.test(t);)t=t.replace(/\/[^/]+\/\.(\.+(?:\/|$))/g,"/$1");return(t=t.replace(/\/\.+(\/|$)/g,"$1"))||"/"}function m(t,e){void 0===e&&(e={});for(var r=function(t){for(var e=[],r=0;r<t.length;){var n=t[r];if("*"!==n&&"+"!==n&&"?"!==n)if("\\"!==n)if("{"!==n)if("}"!==n)if(":"!==n)if("("!==n)e.push({type:"CHAR",index:r,value:t[r++]});else{var i=1,o="";if("?"===t[a=r+1])throw new TypeError('Pattern cannot start with "?" at '+a);for(;a<t.length;)if("\\"!==t[a]){if(")"===t[a]){if(0===--i){a++;break}}else if("("===t[a]&&(i++,"?"!==t[a+1]))throw new TypeError("Capturing groups are not allowed at "+a);o+=t[a++]}else o+=t[a++]+t[a++];if(i)throw new TypeError("Unbalanced pattern at "+r);if(!o)throw new TypeError("Missing pattern at "+r);e.push({type:"PATTERN",index:r,value:o}),r=a}else{for(var s="",a=r+1;a<t.length;){var h=t.charCodeAt(a);if(!(h>=48&&h<=57||h>=65&&h<=90||h>=97&&h<=122||95===h))break;s+=t[a++]}if(!s)throw new TypeError("Missing parameter name at "+r);e.push({type:"NAME",index:r,value:s}),r=a}else e.push({type:"CLOSE",index:r,value:t[r++]});else e.push({type:"OPEN",index:r,value:t[r++]});else e.push({type:"ESCAPED_CHAR",index:r++,value:t[r++]});else e.push({type:"MODIFIER",index:r,value:t[r++]})}return e.push({type:"END",index:r,value:""}),e}(t),n=e.prefixes,i=void 0===n?"./":n,o="[^"+_(e.delimiter||"/#?")+"]+?",s=[],a=0,h=0,u="",c=function(t){if(h<r.length&&r[h].type===t)return r[h++].value},l=function(t){var e=c(t);if(void 0!==e)return e;var n=r[h],i=n.type,o=n.index;throw new TypeError("Unexpected "+i+" at "+o+", expected "+t)},p=function(){for(var t,e="";t=c("CHAR")||c("ESCAPED_CHAR");)e+=t;return e};h<r.length;){var f=c("CHAR"),d=c("NAME"),v=c("PATTERN");if(d||v){var m=f||"";-1===i.indexOf(m)&&(u+=m,m=""),u&&(s.push(u),u=""),s.push({name:d||a++,prefix:m,suffix:"",pattern:v||o,modifier:c("MODIFIER")||""})}else{var g=f||c("ESCAPED_CHAR");if(g)u+=g;else if(u&&(s.push(u),u=""),c("OPEN")){m=p();var y=c("NAME")||"",x=c("PATTERN")||"",b=p();l("CLOSE"),s.push({name:y||(x?a++:""),pattern:y&&!x?o:x,prefix:m,suffix:b,modifier:c("MODIFIER")||""})}else l("END")}}return s}function g(t,e){return function(t,e){void 0===e&&(e={});var r=x(e),n=e.encode,i=void 0===n?function(t){return t}:n,o=e.validate,s=void 0===o||o,a=t.map((function(t){if("object"==typeof t)return new RegExp("^(?:"+t.pattern+")$",r)}));return function(e){for(var r="",n=0;n<t.length;n++){var o=t[n];if("string"!=typeof o){var h=e?e[o.name]:void 0,u="?"===o.modifier||"*"===o.modifier,c="*"===o.modifier||"+"===o.modifier;if(Array.isArray(h)){if(!c)throw new TypeError('Expected "'+o.name+'" to not repeat, but got an array');if(0===h.length){if(u)continue;throw new TypeError('Expected "'+o.name+'" to not be empty')}for(var l=0;l<h.length;l++){var p=i(h[l],o);if(s&&!a[n].test(p))throw new TypeError('Expected all "'+o.name+'" to match "'+o.pattern+'", but got "'+p+'"');r+=o.prefix+p+o.suffix}}else if("string"!=typeof h&&"number"!=typeof h){if(!u){var f=c?"an array":"a string";throw new TypeError('Expected "'+o.name+'" to be '+f)}}else{p=i(String(h),o);if(s&&!a[n].test(p))throw new TypeError('Expected "'+o.name+'" to match "'+o.pattern+'", but got "'+p+'"');r+=o.prefix+p+o.suffix}}else r+=o}return r}}(m(t,e),e)}function y(t,e){var r=[];return function(t,e,r){void 0===r&&(r={});var n=r.decode,i=void 0===n?function(t){return t}:n;return function(r){var n=t.exec(r);if(!n)return!1;for(var o=n[0],s=n.index,a=Object.create(null),h=function(t){if(void 0===n[t])return"continue";var r=e[t-1];"*"===r.modifier||"+"===r.modifier?a[r.name]=n[t].split(r.prefix+r.suffix).map((function(t){return i(t,r)})):a[r.name]=i(n[t],r)},u=1;u<n.length;u++)h(u);return{path:o,index:s,params:a}}}($(t,r,e),r,e)}function _(t){return t.replace(/([.+*?=^!:${}()[\]|/\\])/g,"\\$1")}function x(t){return t&&t.sensitive?"":"i"}function b(t,e,r){return function(t,e,r){void 0===r&&(r={});for(var n=r.strict,i=void 0!==n&&n,o=r.start,s=void 0===o||o,a=r.end,h=void 0===a||a,u=r.encode,c=void 0===u?function(t){return t}:u,l="["+_(r.endsWith||"")+"]|$",p="["+_(r.delimiter||"/#?")+"]",f=s?"^":"",d=0,v=t;d<v.length;d++){var m=v[d];if("string"==typeof m)f+=_(c(m));else{var g=_(c(m.prefix)),y=_(c(m.suffix));if(m.pattern)if(e&&e.push(m),g||y)if("+"===m.modifier||"*"===m.modifier){var b="*"===m.modifier?"?":"";f+="(?:"+g+"((?:"+m.pattern+")(?:"+y+g+"(?:"+m.pattern+"))*)"+y+")"+b}else f+="(?:"+g+"("+m.pattern+")"+y+")"+m.modifier;else f+="("+m.pattern+")"+m.modifier;else f+="(?:"+g+y+")"+m.modifier}}if(h)i||(f+=p+"?"),f+=r.endsWith?"(?="+l+")":"$";else{var $=t[t.length-1],w="string"==typeof $?p.indexOf($[$.length-1])>-1:void 0===$;i||(f+="(?:"+p+"(?="+l+"))?"),w||(f+="(?="+p+"|"+l+")")}return new RegExp(f,x(r))}(m(t,r),e,r)}function $(t,e,r){return t instanceof RegExp?function(t,e){if(!e)return t;for(var r=/\((?:\?<(.*?)>)?(?!\?)/g,n=0,i=r.exec(t.source);i;)e.push({name:i[1]||n++,prefix:"",suffix:"",modifier:"",pattern:""}),i=r.exec(t.source);return t}(t,e):Array.isArray(t)?function(t,e,r){var n=t.map((function(t){return $(t,e,r).source}));return new RegExp("(?:"+n.join("|")+")",x(r))}(t,e,r):b(t,e,r)}function*w(t,e=[]){for(const r of e){const e=r.match(t);if(e)return(r.components||r.redirect)&&(yield{...e,route:r}),void(r.redirect||(yield*w(t,r.children)))}}function E(t){if(void 0!==t){if(null===t)return null;if(!1!==t&&("number"!=typeof t||Number.isFinite(t))&&"function"!=typeof t)return encodeURIComponent(String(t))}}function R(t){const e=[];for(const n of Object.keys(t)){const i=t[n],o=r(i)?i():i,s=encodeURIComponent(n);if(Array.isArray(o))for(const t of o){const r=E(t);void 0!==r&&e.push(null===r?s:`${s}=${r}`)}else{const t=E(o);if(void 0===t)continue;e.push(null===t?s:`${s}=${t}`)}}return e.join("&")}function A(t){const e=Object.create(null);function r(t,r=null){if(!(t in e))return void(e[t]=r);const n=e[t];Array.isArray(n)?n.push(r):e[t]=[n,r]}for(const e of t.split("&")){const t=e.indexOf("=");if(t<0){r(decodeURIComponent(e));continue}r(decodeURIComponent(e.substr(0,t)),decodeURIComponent(e.substr(t+1)))}return e}function k(t){const e=/^([^?#]*)((?:\?[^#]*)?)((?:#.*)?)$/.exec(t);return e?[e[1]||"/",e[2],e[3]]:["/","",""]}var P=Object.freeze({__proto__:null,Memory:class{constructor(e){t(this,"router",void 0),t(this,"index",0),t(this,"history",[]),this.router=e}push(t,e,r,n){this.history.length=this.index+1,this.index++,this.history.push([t,e,r,n])}replace(t,e,r,n){this.history[this.index]=[t,e,r,n]}go(t){let e=this.index+t;if(!(e>=this.history.length||e<0||e===this.index))return this.index=e,this.history[e]}back(){return this.go(-1)}forward(){return this.go(1)}link(t,{childNodes:e,emit:r},n){return s("span",{...t,"on:click":t=>{r("click",t)&&n()}},...e)}},WebPath:class{constructor(e,r){t(this,"router",void 0),t(this,"base",void 0),this.router=e;let n=v((null==r?void 0:r.base)||"");this.base="/"===n?"":n;const i=()=>{this.router._update(this.getPath(),location.search,location.hash,history.state)};window.addEventListener("popstate",i),this.destroy=()=>{this.destroy=()=>{},window.removeEventListener("popstate",i)}}start(){this.router._update(this.getPath(),location.search,location.hash,history.state)}destroy(){}push(t,e,r,n){history.pushState(n,"",`${this.base}${t}${e}${r}`)}replace(t,e,r,n){history.replaceState(n,"",`${this.base}${t}${e}${r}`)}getPath(){const t=location.pathname,{base:e}=this;return e?0!==t.indexOf(e+"/")?t:t.substr(e.length):t}go(t){const e=this.getPath(),r=location.search,n=location.hash,i=history.state;history.go(t);const o=this.getPath(),s=location.search,a=location.hash,h=history.state;if(o!==e||s!==r||a!==n||h!==i)return[o,s,a,h]}back(){return this.go(-1)}forward(){return this.go(1)}link({to:t,...e},{childNodes:r,emit:n},i){return s("a",{...e,href:`${this.base}${this.router.getUrl(t)}`,"on:click":t=>{let e=!n("click",t);t.defaultPrevented||(t.preventDefault(),e||i())}},...r)}},WebHash:class{constructor(e){t(this,"router",void 0),this.router=e;const r=()=>{const[t,e,r]=k(location.hash.substr(1));this.router._update(t,e,r)};window.addEventListener("hashchange",r),this.destroy=()=>{this.destroy=()=>{},window.removeEventListener("hashchange",r)}}start(){const[t,e,r]=k(location.hash.substr(1));this.router._update(t,e,r)}destroy(){}push(t,e,r){location.hash=`#${t}${e}${r}`}replace(t,e,r){location.replace(`#${t}${e}${r}`)}go(t){const e=location.hash;history.go(t);const r=location.hash;if(r!==e)return[...k(r.substr(1)),void 0]}back(){return this.go(-1)}forward(){return this.go(1)}link({to:t,...e},{childNodes:r,emit:n},i){return s("a",{...e,href:"#"+this.router.getUrl(t),"on:click":t=>{let e=!n("click",t);t.defaultPrevented||(t.preventDefault(),e||i())}},...r)}}});function C(t,e,r,n=R){"string"==typeof t&&(t={path:t});const i=t.alias&&e[t.alias],o=t.path&&/^([^?#]*)((?:\?[^#]*)?)((?:#.*)?)$/.exec(t.path);let s=(null==o?void 0:o[1])||"";if(s)if(i){let e=i.toPath(t.params||{});t.append||(e=e.replace(/\/[^/]*\/?$/,"")),s=`${i.toPath(t.params||{})}/${s}`}else t.append&&(s=`${r}/${s}`);else s=i?i.toPath(t.params||{}):r;"/"!==s[0]&&(s=`${r.replace(/\/[^/]*\/?$/,"")}/${s}`),s=v(s);return{path:s,search:t.query&&"?"+n(t.query)||t.search||(null==o?void 0:o[2])||"",hash:t.hash||(null==o?void 0:o[3])||""}}const O=[];class T{static get history(){return P}static get install(){return l}static get View(){return f}static get Link(){return d}get size(){return this._size()}get matches(){return this._matches()}get alias(){return this._alias()}get path(){return this._path()}get search(){return this._search()}get hash(){return this._hash()}get state(){return this._state()}get params(){return this._params()}get query(){return this._query()}get meta(){return this._meta()}constructor({History:r,historyOption:n}){if(t(this,"_namedRoutes",Object.create(null)),t(this,"_routes",[]),t(this,"history",void 0),t(this,"_size",e(0)),t(this,"_nodes",[]),t(this,"_matches",e([])),t(this,"_hash",e("")),t(this,"_search",e("")),t(this,"_alias",e("")),t(this,"_path",e("/")),t(this,"_state",e(void 0)),t(this,"_params",e({})),t(this,"_query",e({})),t(this,"_meta",e({})),r){var i;const t=new r(this,n);this.history=t,null===(i=t.start)||void 0===i||i.call(t)}}setRoutes(t){const e=Object.create(null);this._routes=t.map(t=>function t(e,r,n){let{path:i,children:o,alias:s,meta:a,component:h,components:u,...c}=e,l=!(Array.isArray(o)&&o.length);i&&"*"!==i||(i="",l=!1),"/"!==i[0]&&(i=`${(null==n?void 0:n.path)||""}/${i}`),i=v(i),h&&(u||(u={}),u.default=h);const p={...c,path:i,alias:s,component:h,components:u,meta:a||{},toPath:g(i||"",{encode:encodeURIComponent}),match:y(i||"",{end:l,decode:decodeURIComponent})};return s&&(r[s]=p),Array.isArray(o)&&(p.children=o.map(e=>t(e,r,p))),p}(t,e)),this._namedRoutes=e,this._update(this._path(),this._search(),this._hash(),this._state(),!0)}_get(t){var e,r;const n=null===(e=(r=this._nodes)[t])||void 0===e?void 0:e.call(r);if(n)return n;this._size()}_update(t,r,n,o,s=!1){if(this._path()!==t||s){var a;const r=[...w(t,this._routes)],n=r[r.length-1];if(n&&!n.route.components){if(O.push(t),O.length>=10)throw new i("Too many consecutive redirect jumps: \n"+O.join("\n"),"router");const{redirect:e,append:r}=n.route;try{return void(r?this.replace(`${t}/${e}`,o):e&&"/"===e[0]?this.replace(e,o):this.replace(`${t}/../${e}`,o))}finally{O.pop()}}const s=this._nodes,h=s.length,u=r.length,c=Math.min(u,h);for(let t=0;t<c;t++)s[t](r[t]);for(let t=c;t<h;t++)s[t](void 0);for(let t=c;t<u;t++)s[t]=e(r[t]);s.length=u,this._size(u),this._matches(r),this._path(t),this._alias((null==n||null===(a=n.route)||void 0===a?void 0:a.alias)||""),this._params((null==n?void 0:n.params)||{}),this._meta(Object.assign({},...r.map(t=>t.route.meta)))}this._search()!==r&&(this._search(r),this._query((this.parse||A)(r.substr(1)))),this._hash(n),this._state(o)}push(t,e){var r;const{path:n,search:i,hash:o}=C(t,this._namedRoutes,this._path(),this.stringify);null===(r=this.history)||void 0===r||r.push(n,i,o,e),this._update(n,i,o,e)}replace(t,e){var r;const{path:n,search:i,hash:o}=C(t,this._namedRoutes,this._path(),this.stringify);null===(r=this.history)||void 0===r||r.replace(n,i,o,e),this._update(n,i,o,e)}getUrl(t){const{path:e,search:r,hash:n}=C(t,this._namedRoutes,this._path(),this.stringify);return`${e}${r}${n}`}go(t){var e;const r=null===(e=this.history)||void 0===e?void 0:e.go(t);r&&this._update(...r)}back(){var t;const e=null===(t=this.history)||void 0===t?void 0:t.back();e&&this._update(...e)}forward(){var t;const e=null===(t=this.history)||void 0===t?void 0:t.forward();e&&this._update(...e)}get view(){const t=a((t,...e)=>f({...t,router:this},...e),{name:"Router"});return Reflect.defineProperty(this,"view",{value:t,enumerable:!0,configurable:!0}),t}}function N(t,e){return{get size(){return t.size},get matches(){return t.matches},get match(){return t._get(e)},get alias(){return t.alias},get path(){return t.path},get search(){return t.search},get hash(){return t.hash},get state(){return t.state},get params(){return t.params},get query(){return t.query},get meta(){return t.meta},get router(){return t},push:(e,r)=>t.push(e,r),replace:(e,r)=>t.replace(e,r),getUrl:e=>t.getUrl(e),go:e=>t.go(e),back:()=>t.back(),forward:()=>t.forward()}}function I(t){const e=t.delivered(c);if(!e)return;const{router:r,depth:n}=e;Reflect.defineProperty(t,"route",{value:N(r,n),enumerable:!0,configurable:!0}),Reflect.defineProperty(t,"match",{get:()=>null==r?void 0:r._get(n),enumerable:!0,configurable:!0})}var U=[function(){n("RouterView",f),n("router-view",f),n("RouterLink",d),n("router-link",d)},function(){u(I)},function(){c=h()}];function j(t){l(t);for(const t of U)t()}export default T;export{d as RouterLink,f as RouterView,P as history,j as install};
