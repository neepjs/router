/*!
 * NeepRouter v0.1.0-alpha.5
 * (c) 2020-2021 Fierflame
 * @license MIT
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@neep/core")):"function"==typeof define&&define.amd?define(["exports","@neep/core"],t):t((e=e||self).NeepRouter={},e.Neep)}(this,(function(e,t){"use strict";function r(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function n(e){}let i;function o(e,t,r){return"number"==typeof r&&Number.isInteger(r)?r<0?e.size+r:r:t}var s=t.createShellComponent((function(e,r){const n=function(e,{delivered:t}){if(e.router instanceof $){const t=e.router;if(!(t instanceof $))return null;let r=o(t,0,e.depth);return r<0?null:{router:t,depth:r}}const r=t(i);if(!r)return null;const n=r.router;let s=o(n,r.depth+1,e.depth);return s<0?null:{router:n,depth:s}}(e,r);if(!n)return null;const{router:s}=n;let{depth:a}=n;const u=e.name||"default";for(let r=s._get(a);r;r=s._get(++a)){const{components:n}=r.route;if(!n)continue;const o=u in n?n[u]:void 0;if(o)return t.label({text:`{path=${r.path}}[${u}]`,color:"#987654"}),t.createElementBase(i,{value:{depth:a,router:s}},t.createElementBase(o,e))}return r.childNodes}),{name:"RouterView"}),a=t.createShellComponent((function(e,r){var n;const{route:i,childNodes:o}=r;if(!i)return t.createElementBase("template",{},...o);let{to:s,append:a,replace:u,path:h,search:c,hash:l,query:p,alias:f,params:d}=e;function v(){i&&s&&(u?i.replace(s):i.push(s))}return s?"string"==typeof s&&(s={path:s}):s={path:h,search:c,hash:l,query:p,alias:f,params:d},a&&(s.append=!0),(null===(n=i.router.history)||void 0===n?void 0:n.link({...e,to:s},r,v))||t.createElementBase("span",{"on:click":v},...o)}),{name:"RouterLink"});function u(e){for(e=("/"+e).replace(/\/+(\/|$)/g,"$1");/[^/]+\/\.{2,}(\/|$)/.test(e);)e=e.replace(/\/[^/]+\/\.(\.+(?:\/|$))/g,"/$1");return(e=e.replace(/\/\.+(\/|$)/g,"$1"))||"/"}function h(e,t){void 0===t&&(t={});for(var r=function(e){for(var t=[],r=0;r<e.length;){var n=e[r];if("*"!==n&&"+"!==n&&"?"!==n)if("\\"!==n)if("{"!==n)if("}"!==n)if(":"!==n)if("("!==n)t.push({type:"CHAR",index:r,value:e[r++]});else{var i=1,o="";if("?"===e[a=r+1])throw new TypeError('Pattern cannot start with "?" at '+a);for(;a<e.length;)if("\\"!==e[a]){if(")"===e[a]){if(0===--i){a++;break}}else if("("===e[a]&&(i++,"?"!==e[a+1]))throw new TypeError("Capturing groups are not allowed at "+a);o+=e[a++]}else o+=e[a++]+e[a++];if(i)throw new TypeError("Unbalanced pattern at "+r);if(!o)throw new TypeError("Missing pattern at "+r);t.push({type:"PATTERN",index:r,value:o}),r=a}else{for(var s="",a=r+1;a<e.length;){var u=e.charCodeAt(a);if(!(u>=48&&u<=57||u>=65&&u<=90||u>=97&&u<=122||95===u))break;s+=e[a++]}if(!s)throw new TypeError("Missing parameter name at "+r);t.push({type:"NAME",index:r,value:s}),r=a}else t.push({type:"CLOSE",index:r,value:e[r++]});else t.push({type:"OPEN",index:r,value:e[r++]});else t.push({type:"ESCAPED_CHAR",index:r++,value:e[r++]});else t.push({type:"MODIFIER",index:r,value:e[r++]})}return t.push({type:"END",index:r,value:""}),t}(e),n=t.prefixes,i=void 0===n?"./":n,o="[^"+p(t.delimiter||"/#?")+"]+?",s=[],a=0,u=0,h="",c=function(e){if(u<r.length&&r[u].type===e)return r[u++].value},l=function(e){var t=c(e);if(void 0!==t)return t;var n=r[u],i=n.type,o=n.index;throw new TypeError("Unexpected "+i+" at "+o+", expected "+e)},f=function(){for(var e,t="";e=c("CHAR")||c("ESCAPED_CHAR");)t+=e;return t};u<r.length;){var d=c("CHAR"),v=c("NAME"),m=c("PATTERN");if(v||m){var g=d||"";-1===i.indexOf(g)&&(h+=g,g=""),h&&(s.push(h),h=""),s.push({name:v||a++,prefix:g,suffix:"",pattern:m||o,modifier:c("MODIFIER")||""})}else{var y=d||c("ESCAPED_CHAR");if(y)h+=y;else if(h&&(s.push(h),h=""),c("OPEN")){g=f();var _=c("NAME")||"",x=c("PATTERN")||"",b=f();l("CLOSE"),s.push({name:_||(x?a++:""),pattern:_&&!x?o:x,prefix:g,suffix:b,modifier:c("MODIFIER")||""})}else l("END")}}return s}function c(e,t){return function(e,t){void 0===t&&(t={});var r=f(t),n=t.encode,i=void 0===n?function(e){return e}:n,o=t.validate,s=void 0===o||o,a=e.map((function(e){if("object"==typeof e)return new RegExp("^(?:"+e.pattern+")$",r)}));return function(t){for(var r="",n=0;n<e.length;n++){var o=e[n];if("string"!=typeof o){var u=t?t[o.name]:void 0,h="?"===o.modifier||"*"===o.modifier,c="*"===o.modifier||"+"===o.modifier;if(Array.isArray(u)){if(!c)throw new TypeError('Expected "'+o.name+'" to not repeat, but got an array');if(0===u.length){if(h)continue;throw new TypeError('Expected "'+o.name+'" to not be empty')}for(var l=0;l<u.length;l++){var p=i(u[l],o);if(s&&!a[n].test(p))throw new TypeError('Expected all "'+o.name+'" to match "'+o.pattern+'", but got "'+p+'"');r+=o.prefix+p+o.suffix}}else if("string"!=typeof u&&"number"!=typeof u){if(!h){var f=c?"an array":"a string";throw new TypeError('Expected "'+o.name+'" to be '+f)}}else{p=i(String(u),o);if(s&&!a[n].test(p))throw new TypeError('Expected "'+o.name+'" to match "'+o.pattern+'", but got "'+p+'"');r+=o.prefix+p+o.suffix}}else r+=o}return r}}(h(e,t),t)}function l(e,t){var r=[];return function(e,t,r){void 0===r&&(r={});var n=r.decode,i=void 0===n?function(e){return e}:n;return function(r){var n=e.exec(r);if(!n)return!1;for(var o=n[0],s=n.index,a=Object.create(null),u=function(e){if(void 0===n[e])return"continue";var r=t[e-1];"*"===r.modifier||"+"===r.modifier?a[r.name]=n[e].split(r.prefix+r.suffix).map((function(e){return i(e,r)})):a[r.name]=i(n[e],r)},h=1;h<n.length;h++)u(h);return{path:o,index:s,params:a}}}(v(e,r,t),r,t)}function p(e){return e.replace(/([.+*?=^!:${}()[\]|/\\])/g,"\\$1")}function f(e){return e&&e.sensitive?"":"i"}function d(e,t,r){return function(e,t,r){void 0===r&&(r={});for(var n=r.strict,i=void 0!==n&&n,o=r.start,s=void 0===o||o,a=r.end,u=void 0===a||a,h=r.encode,c=void 0===h?function(e){return e}:h,l="["+p(r.endsWith||"")+"]|$",d="["+p(r.delimiter||"/#?")+"]",v=s?"^":"",m=0,g=e;m<g.length;m++){var y=g[m];if("string"==typeof y)v+=p(c(y));else{var _=p(c(y.prefix)),x=p(c(y.suffix));if(y.pattern)if(t&&t.push(y),_||x)if("+"===y.modifier||"*"===y.modifier){var b="*"===y.modifier?"?":"";v+="(?:"+_+"((?:"+y.pattern+")(?:"+x+_+"(?:"+y.pattern+"))*)"+x+")"+b}else v+="(?:"+_+"("+y.pattern+")"+x+")"+y.modifier;else v+="("+y.pattern+")"+y.modifier;else v+="(?:"+_+x+")"+y.modifier}}if(u)i||(v+=d+"?"),v+=r.endsWith?"(?="+l+")":"$";else{var w=e[e.length-1],E="string"==typeof w?d.indexOf(w[w.length-1])>-1:void 0===w;i||(v+="(?:"+d+"(?="+l+"))?"),E||(v+="(?="+d+"|"+l+")")}return new RegExp(v,f(r))}(h(e,r),t,r)}function v(e,t,r){return e instanceof RegExp?function(e,t){if(!t)return e;for(var r=/\((?:\?<(.*?)>)?(?!\?)/g,n=0,i=r.exec(e.source);i;)t.push({name:i[1]||n++,prefix:"",suffix:"",modifier:"",pattern:""}),i=r.exec(e.source);return e}(e,t):Array.isArray(e)?function(e,t,r){var n=e.map((function(e){return v(e,t,r).source}));return new RegExp("(?:"+n.join("|")+")",f(r))}(e,t,r):d(e,t,r)}function*m(e,t=[]){for(const r of t){const t=r.match(e);if(t)return(r.components||r.redirect)&&(yield{...t,route:r}),void(r.redirect||(yield*m(e,r.children)))}}function g(e){if(void 0!==e){if(null===e)return null;if(!1!==e&&("number"!=typeof e||Number.isFinite(e))&&"function"!=typeof e)return encodeURIComponent(String(e))}}function y(e){const r=[];for(const n of Object.keys(e)){const i=e[n],o=t.isValue(i)?i():i,s=encodeURIComponent(n);if(Array.isArray(o))for(const e of o){const t=g(e);void 0!==t&&r.push(null===t?s:`${s}=${t}`)}else{const e=g(o);if(void 0===e)continue;r.push(null===e?s:`${s}=${e}`)}}return r.join("&")}function _(e){const t=Object.create(null);function r(e,r=null){if(!(e in t))return void(t[e]=r);const n=t[e];Array.isArray(n)?n.push(r):t[e]=[n,r]}for(const t of e.split("&")){const e=t.indexOf("=");if(e<0){r(decodeURIComponent(t));continue}r(decodeURIComponent(t.substr(0,e)),decodeURIComponent(t.substr(e+1)))}return t}function x(e){const t=/^([^?#]*)((?:\?[^#]*)?)((?:#.*)?)$/.exec(e);return t?[t[1]||"/",t[2],t[3]]:["/","",""]}var b=Object.freeze({__proto__:null,Memory:class{constructor(e){r(this,"router",void 0),r(this,"index",0),r(this,"history",[]),this.router=e}push(e,t,r,n){this.history.length=this.index+1,this.index++,this.history.push([e,t,r,n])}replace(e,t,r,n){this.history[this.index]=[e,t,r,n]}go(e){let t=this.index+e;if(!(t>=this.history.length||t<0||t===this.index))return this.index=t,this.history[t]}back(){return this.go(-1)}forward(){return this.go(1)}link(e,{childNodes:r,emit:n},i){return t.createElementBase("span",{...e,"on:click":e=>{n("click",e)&&i()}},...r)}},WebPath:class{constructor(e,t){r(this,"router",void 0),r(this,"base",void 0),this.router=e;let n=u((null==t?void 0:t.base)||"");this.base="/"===n?"":n;const i=()=>{this.router._update(this.getPath(),location.search,location.hash,history.state)};window.addEventListener("popstate",i),this.destroy=()=>{this.destroy=()=>{},window.removeEventListener("popstate",i)}}start(){this.router._update(this.getPath(),location.search,location.hash,history.state)}destroy(){}push(e,t,r,n){history.pushState(n,"",`${this.base}${e}${t}${r}`)}replace(e,t,r,n){history.replaceState(n,"",`${this.base}${e}${t}${r}`)}getPath(){const e=location.pathname,{base:t}=this;return t?0!==e.indexOf(t+"/")?e:e.substr(t.length):e}go(e){const t=this.getPath(),r=location.search,n=location.hash,i=history.state;history.go(e);const o=this.getPath(),s=location.search,a=location.hash,u=history.state;if(o!==t||s!==r||a!==n||u!==i)return[o,s,a,u]}back(){return this.go(-1)}forward(){return this.go(1)}link({to:e,...r},{childNodes:n,emit:i},o){return t.createElementBase("a",{...r,href:`${this.base}${this.router.getUrl(e)}`,"on:click":e=>{let t=!i("click",e);e.defaultPrevented||(e.preventDefault(),t||o())}},...n)}},WebHash:class{constructor(e){r(this,"router",void 0),this.router=e;const t=()=>{const[e,t,r]=x(location.hash.substr(1));this.router._update(e,t,r)};window.addEventListener("hashchange",t),this.destroy=()=>{this.destroy=()=>{},window.removeEventListener("hashchange",t)}}start(){const[e,t,r]=x(location.hash.substr(1));this.router._update(e,t,r)}destroy(){}push(e,t,r){location.hash=`#${e}${t}${r}`}replace(e,t,r){location.replace(`#${e}${t}${r}`)}go(e){const t=location.hash;history.go(e);const r=location.hash;if(r!==t)return[...x(r.substr(1)),void 0]}back(){return this.go(-1)}forward(){return this.go(1)}link({to:e,...r},{childNodes:n,emit:i},o){return t.createElementBase("a",{...r,href:"#"+this.router.getUrl(e),"on:click":e=>{let t=!i("click",e);e.defaultPrevented||(e.preventDefault(),t||o())}},...n)}}});function w(e,t,r,n=y){"string"==typeof e&&(e={path:e});const i=e.alias&&t[e.alias],o=e.path&&/^([^?#]*)((?:\?[^#]*)?)((?:#.*)?)$/.exec(e.path);let s=(null==o?void 0:o[1])||"";if(s)if(i){let t=i.toPath(e.params||{});e.append||(t=t.replace(/\/[^/]*\/?$/,"")),s=`${i.toPath(e.params||{})}/${s}`}else e.append&&(s=`${r}/${s}`);else s=i?i.toPath(e.params||{}):r;"/"!==s[0]&&(s=`${r.replace(/\/[^/]*\/?$/,"")}/${s}`),s=u(s);return{path:s,search:e.query&&"?"+n(e.query)||e.search||(null==o?void 0:o[2])||"",hash:e.hash||(null==o?void 0:o[3])||""}}const E=[];class ${static get history(){return b}static get install(){return n}static get View(){return s}static get Link(){return a}get size(){return this._size()}get matches(){return this._matches()}get alias(){return this._alias()}get path(){return this._path()}get search(){return this._search()}get hash(){return this._hash()}get state(){return this._state()}get params(){return this._params()}get query(){return this._query()}get meta(){return this._meta()}constructor({History:e,historyOption:n}){if(r(this,"_namedRoutes",Object.create(null)),r(this,"_routes",[]),r(this,"history",void 0),r(this,"_size",t.value(0)),r(this,"_nodes",[]),r(this,"_matches",t.value([])),r(this,"_hash",t.value("")),r(this,"_search",t.value("")),r(this,"_alias",t.value("")),r(this,"_path",t.value("/")),r(this,"_state",t.value(void 0)),r(this,"_params",t.value({})),r(this,"_query",t.value({})),r(this,"_meta",t.value({})),e){var i;const t=new e(this,n);this.history=t,null===(i=t.start)||void 0===i||i.call(t)}}setRoutes(e){const t=Object.create(null);this._routes=e.map(e=>function e(t,r,n){let{path:i,children:o,alias:s,meta:a,component:h,components:p,...f}=t,d=!(Array.isArray(o)&&o.length);i&&"*"!==i||(i="",d=!1),"/"!==i[0]&&(i=`${(null==n?void 0:n.path)||""}/${i}`),i=u(i),h&&(p||(p={}),p.default=h);const v={...f,path:i,alias:s,component:h,components:p,meta:a||{},toPath:c(i||"",{encode:encodeURIComponent}),match:l(i||"",{end:d,decode:decodeURIComponent})};return s&&(r[s]=v),Array.isArray(o)&&(v.children=o.map(t=>e(t,r,v))),v}(e,t)),this._namedRoutes=t,this._update(this._path(),this._search(),this._hash(),this._state(),!0)}_get(e){var t,r;const n=null===(t=(r=this._nodes)[e])||void 0===t?void 0:t.call(r);if(n)return n;this._size()}_update(e,r,n,i,o=!1){if(this._path()!==e||o){var s;const r=[...m(e,this._routes)],n=r[r.length-1];if(n&&!n.route.components){if(E.push(e),E.length>=10)throw new t.Error("Too many consecutive redirect jumps: \n"+E.join("\n"),"router");const{redirect:r,append:o}=n.route;try{return void(o?this.replace(`${e}/${r}`,i):r&&"/"===r[0]?this.replace(r,i):this.replace(`${e}/../${r}`,i))}finally{E.pop()}}const o=this._nodes,a=o.length,u=r.length,h=Math.min(u,a);for(let e=0;e<h;e++)o[e](r[e]);for(let e=h;e<a;e++)o[e](void 0);for(let e=h;e<u;e++)o[e]=t.value(r[e]);o.length=u,this._size(u),this._matches(r),this._path(e),this._alias((null==n||null===(s=n.route)||void 0===s?void 0:s.alias)||""),this._params((null==n?void 0:n.params)||{}),this._meta(Object.assign({},...r.map(e=>e.route.meta)))}this._search()!==r&&(this._search(r),this._query((this.parse||_)(r.substr(1)))),this._hash(n),this._state(i)}push(e,t){var r;const{path:n,search:i,hash:o}=w(e,this._namedRoutes,this._path(),this.stringify);null===(r=this.history)||void 0===r||r.push(n,i,o,t),this._update(n,i,o,t)}replace(e,t){var r;const{path:n,search:i,hash:o}=w(e,this._namedRoutes,this._path(),this.stringify);null===(r=this.history)||void 0===r||r.replace(n,i,o,t),this._update(n,i,o,t)}getUrl(e){const{path:t,search:r,hash:n}=w(e,this._namedRoutes,this._path(),this.stringify);return`${t}${r}${n}`}go(e){var t;const r=null===(t=this.history)||void 0===t?void 0:t.go(e);r&&this._update(...r)}back(){var e;const t=null===(e=this.history)||void 0===e?void 0:e.back();t&&this._update(...t)}forward(){var e;const t=null===(e=this.history)||void 0===e?void 0:e.forward();t&&this._update(...t)}get view(){const e=t.createShellComponent((e,...t)=>s({...e,router:this},...t),{name:"Router"});return Reflect.defineProperty(this,"view",{value:e,enumerable:!0,configurable:!0}),e}}function R(e,t){return{get size(){return e.size},get matches(){return e.matches},get match(){return e._get(t)},get alias(){return e.alias},get path(){return e.path},get search(){return e.search},get hash(){return e.hash},get state(){return e.state},get params(){return e.params},get query(){return e.query},get meta(){return e.meta},get router(){return e},push:(t,r)=>e.push(t,r),replace:(t,r)=>e.replace(t,r),getUrl:t=>e.getUrl(t),go:t=>e.go(t),back:()=>e.back(),forward:()=>e.forward()}}function A(e){const t=e.delivered(i);if(!t)return;const{router:r,depth:n}=t;Reflect.defineProperty(e,"route",{value:R(r,n),enumerable:!0,configurable:!0}),Reflect.defineProperty(e,"match",{get:()=>null==r?void 0:r._get(n),enumerable:!0,configurable:!0})}var k=[function(){t.register("RouterView",s),t.register("router-view",s),t.register("RouterLink",a),t.register("router-link",a)},function(){t.addContextConstructor(A)},function(){i=t.createDeliverComponent()}];for(const e of k)e();e.RouterLink=a,e.RouterView=s,e.default=$,e.history=b,e.install=function(e){},Object.defineProperty(e,"__esModule",{value:!0})}));
