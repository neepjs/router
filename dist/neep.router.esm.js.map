{"version":3,"file":"neep.router.esm.js","sources":["../src/install/context.ts","../src/install/index.ts","../src/View.ts","../src/Link.ts","../src/util.ts","../node_modules/path-to-regexp/dist.es2015/index.js","../src/route.ts","../src/query.ts","../src/history/Memory.ts","../src/history/WebPath.ts","../src/history/WebHash.ts","../src/Router.ts"],"sourcesContent":["import { Context } from '@neep/core';\n\nexport default function contextConstructor(context: Context) {\n\tconst router = context.delivered.__NeepRouter__;\n\tconst depth = context.delivered.__RouteDepth__ || 0;\n\tReflect.defineProperty(context, 'route', {\n\t\tvalue: router,\n\t\tenumerable: true,\n\t\tconfigurable: true,\n\t});\n\tReflect.defineProperty(context, 'match', {\n\t\tget: () => router?._get(depth),\n\t\tenumerable: true,\n\t\tconfigurable: true,\n\t});\n}","import contextConstructor from './context';\n\nexport let Neep: typeof import ('@neep/core');\nexport default function install(neep: typeof import ('@neep/core')) {\n\tNeep = neep;\n\tNeep.addContextConstructor(contextConstructor);\n}","import { Context, Auxiliary, mName, mSimple } from '@neep/core';\nimport Router from './Router';\nexport default function RouterView(\n\tprops: {name?: string; depth?: number; router?: Router},\n\t{ delivered }: Context,\n\t{ createElement, Deliver, label }: Auxiliary,\n) {\n\tconst isNew = props.router instanceof Router;\n\tconst router = isNew ? props.router : delivered.__NeepRouter__;\n\tif (!(router instanceof Router)) { return; }\n\tlet depth = props.depth;\n\tif (typeof depth === 'number' && Number.isInteger(depth)) {\n\t\tif (depth < 0) { depth = router.size - depth; }\n\t} else {\n\t\tdepth = isNew ? 0 : (delivered.__RouteDepth__ || 0) + 1;\n\t}\n\tif (depth < 0) { return null; }\n\tconst match = router._get(depth);\n\tif (!match) { return; }\n\tconst { route: { components } } = match;\n\tif (!components) { return null; }\n\tconst name = props.name || 'default';\n\tconst component = name in components ? components[name] : undefined;\n\tif (!component) { return null; }\n\tlabel(`[path=${match.path}]`, '#987654');\n\treturn createElement(Deliver, {\n\t\t__RouteDepth__: depth,\n\t\t__NeepRouter__: router,\n\t}, createElement(component, props));\n}\nmSimple(RouterView)\nmName('RouterView', RouterView);","import { Context, Auxiliary, mName, mSimple } from '@neep/core';\nimport { Location } from './type';\nexport default function RouterLink(\n\tprops: { to?: Location | string; replace?: boolean} & Location,\n\tcontext: Context,\n\tauxiliary: Auxiliary,\n) {\n\tconst { route, childNodes } = context;\n\tconst { createElement } = auxiliary;\n\t// return null;screenLeft\n\tif (!route) { return createElement('template', {}, ...childNodes); }\n\tlet {to, append, replace, path, search, hash, query, alias, params} = props;\n\tif (!to) {\n\t\tto = { path, search, hash, query, alias, params };\n\t} else if (typeof to === 'string') {\n\t\tto = { path: to };\n\t}\n\tif (append) {\n\t\tto.append = true;\n\t}\n\tfunction onclick() {\n\t\tif (!route || !to) { return; }\n\t\tif (replace) {\n\t\t\troute.replace(to);\n\t\t} else {\n\t\t\troute.push(to);\n\t\t}\n\t}\n\treturn route\n\t\t.history?.link({...props, to}, context, auxiliary, onclick)\n\t\t|| createElement('span', {onclick}, ...childNodes);\n\n}\nmSimple(RouterLink)\nmName('RouterView', RouterLink);","export function cleanPath(path: string) {\n\tpath = `/${path}`.replace(/\\/+(\\/|$)/g, '$1');\n\twhile(/[^/]+\\/\\.{2,}(\\/|$)/.test(path)) {\n\t\tpath = path.replace(/\\/[^/]+\\/\\.(\\.+(?:\\/|$))/g, '/$1');\n\t}\n\tpath = path.replace(/\\/\\.+(\\/|$)/g, '$1');\n\treturn path || '/';\n}","/**\n * Tokenize input string.\n */\nfunction lexer(str) {\n    var tokens = [];\n    var i = 0;\n    while (i < str.length) {\n        var char = str[i];\n        if (char === \"*\" || char === \"+\" || char === \"?\") {\n            tokens.push({ type: \"MODIFIER\", index: i, value: str[i++] });\n            continue;\n        }\n        if (char === \"\\\\\") {\n            tokens.push({ type: \"ESCAPED_CHAR\", index: i++, value: str[i++] });\n            continue;\n        }\n        if (char === \"{\") {\n            tokens.push({ type: \"OPEN\", index: i, value: str[i++] });\n            continue;\n        }\n        if (char === \"}\") {\n            tokens.push({ type: \"CLOSE\", index: i, value: str[i++] });\n            continue;\n        }\n        if (char === \":\") {\n            var name = \"\";\n            var j = i + 1;\n            while (j < str.length) {\n                var code = str.charCodeAt(j);\n                if (\n                // `0-9`\n                (code >= 48 && code <= 57) ||\n                    // `A-Z`\n                    (code >= 65 && code <= 90) ||\n                    // `a-z`\n                    (code >= 97 && code <= 122) ||\n                    // `_`\n                    code === 95) {\n                    name += str[j++];\n                    continue;\n                }\n                break;\n            }\n            if (!name)\n                throw new TypeError(\"Missing parameter name at \" + i);\n            tokens.push({ type: \"NAME\", index: i, value: name });\n            i = j;\n            continue;\n        }\n        if (char === \"(\") {\n            var count = 1;\n            var pattern = \"\";\n            var j = i + 1;\n            if (str[j] === \"?\") {\n                throw new TypeError(\"Pattern cannot start with \\\"?\\\" at \" + j);\n            }\n            while (j < str.length) {\n                if (str[j] === \"\\\\\") {\n                    pattern += str[j++] + str[j++];\n                    continue;\n                }\n                if (str[j] === \")\") {\n                    count--;\n                    if (count === 0) {\n                        j++;\n                        break;\n                    }\n                }\n                else if (str[j] === \"(\") {\n                    count++;\n                    if (str[j + 1] !== \"?\") {\n                        throw new TypeError(\"Capturing groups are not allowed at \" + j);\n                    }\n                }\n                pattern += str[j++];\n            }\n            if (count)\n                throw new TypeError(\"Unbalanced pattern at \" + i);\n            if (!pattern)\n                throw new TypeError(\"Missing pattern at \" + i);\n            tokens.push({ type: \"PATTERN\", index: i, value: pattern });\n            i = j;\n            continue;\n        }\n        tokens.push({ type: \"CHAR\", index: i, value: str[i++] });\n    }\n    tokens.push({ type: \"END\", index: i, value: \"\" });\n    return tokens;\n}\n/**\n * Parse a string for the raw tokens.\n */\nexport function parse(str, options) {\n    if (options === void 0) { options = {}; }\n    var tokens = lexer(str);\n    var _a = options.prefixes, prefixes = _a === void 0 ? \"./\" : _a;\n    var defaultPattern = \"[^\" + escapeString(options.delimiter || \"/#?\") + \"]+?\";\n    var result = [];\n    var key = 0;\n    var i = 0;\n    var path = \"\";\n    var tryConsume = function (type) {\n        if (i < tokens.length && tokens[i].type === type)\n            return tokens[i++].value;\n    };\n    var mustConsume = function (type) {\n        var value = tryConsume(type);\n        if (value !== undefined)\n            return value;\n        var _a = tokens[i], nextType = _a.type, index = _a.index;\n        throw new TypeError(\"Unexpected \" + nextType + \" at \" + index + \", expected \" + type);\n    };\n    var consumeText = function () {\n        var result = \"\";\n        var value;\n        // tslint:disable-next-line\n        while ((value = tryConsume(\"CHAR\") || tryConsume(\"ESCAPED_CHAR\"))) {\n            result += value;\n        }\n        return result;\n    };\n    while (i < tokens.length) {\n        var char = tryConsume(\"CHAR\");\n        var name = tryConsume(\"NAME\");\n        var pattern = tryConsume(\"PATTERN\");\n        if (name || pattern) {\n            var prefix = char || \"\";\n            if (prefixes.indexOf(prefix) === -1) {\n                path += prefix;\n                prefix = \"\";\n            }\n            if (path) {\n                result.push(path);\n                path = \"\";\n            }\n            result.push({\n                name: name || key++,\n                prefix: prefix,\n                suffix: \"\",\n                pattern: pattern || defaultPattern,\n                modifier: tryConsume(\"MODIFIER\") || \"\"\n            });\n            continue;\n        }\n        var value = char || tryConsume(\"ESCAPED_CHAR\");\n        if (value) {\n            path += value;\n            continue;\n        }\n        if (path) {\n            result.push(path);\n            path = \"\";\n        }\n        var open = tryConsume(\"OPEN\");\n        if (open) {\n            var prefix = consumeText();\n            var name_1 = tryConsume(\"NAME\") || \"\";\n            var pattern_1 = tryConsume(\"PATTERN\") || \"\";\n            var suffix = consumeText();\n            mustConsume(\"CLOSE\");\n            result.push({\n                name: name_1 || (pattern_1 ? key++ : \"\"),\n                pattern: name_1 && !pattern_1 ? defaultPattern : pattern_1,\n                prefix: prefix,\n                suffix: suffix,\n                modifier: tryConsume(\"MODIFIER\") || \"\"\n            });\n            continue;\n        }\n        mustConsume(\"END\");\n    }\n    return result;\n}\n/**\n * Compile a string to a template function for the path.\n */\nexport function compile(str, options) {\n    return tokensToFunction(parse(str, options), options);\n}\n/**\n * Expose a method for transforming tokens into the path function.\n */\nexport function tokensToFunction(tokens, options) {\n    if (options === void 0) { options = {}; }\n    var reFlags = flags(options);\n    var _a = options.encode, encode = _a === void 0 ? function (x) { return x; } : _a, _b = options.validate, validate = _b === void 0 ? true : _b;\n    // Compile all the tokens into regexps.\n    var matches = tokens.map(function (token) {\n        if (typeof token === \"object\") {\n            return new RegExp(\"^(?:\" + token.pattern + \")$\", reFlags);\n        }\n    });\n    return function (data) {\n        var path = \"\";\n        for (var i = 0; i < tokens.length; i++) {\n            var token = tokens[i];\n            if (typeof token === \"string\") {\n                path += token;\n                continue;\n            }\n            var value = data ? data[token.name] : undefined;\n            var optional = token.modifier === \"?\" || token.modifier === \"*\";\n            var repeat = token.modifier === \"*\" || token.modifier === \"+\";\n            if (Array.isArray(value)) {\n                if (!repeat) {\n                    throw new TypeError(\"Expected \\\"\" + token.name + \"\\\" to not repeat, but got an array\");\n                }\n                if (value.length === 0) {\n                    if (optional)\n                        continue;\n                    throw new TypeError(\"Expected \\\"\" + token.name + \"\\\" to not be empty\");\n                }\n                for (var j = 0; j < value.length; j++) {\n                    var segment = encode(value[j], token);\n                    if (validate && !matches[i].test(segment)) {\n                        throw new TypeError(\"Expected all \\\"\" + token.name + \"\\\" to match \\\"\" + token.pattern + \"\\\", but got \\\"\" + segment + \"\\\"\");\n                    }\n                    path += token.prefix + segment + token.suffix;\n                }\n                continue;\n            }\n            if (typeof value === \"string\" || typeof value === \"number\") {\n                var segment = encode(String(value), token);\n                if (validate && !matches[i].test(segment)) {\n                    throw new TypeError(\"Expected \\\"\" + token.name + \"\\\" to match \\\"\" + token.pattern + \"\\\", but got \\\"\" + segment + \"\\\"\");\n                }\n                path += token.prefix + segment + token.suffix;\n                continue;\n            }\n            if (optional)\n                continue;\n            var typeOfMessage = repeat ? \"an array\" : \"a string\";\n            throw new TypeError(\"Expected \\\"\" + token.name + \"\\\" to be \" + typeOfMessage);\n        }\n        return path;\n    };\n}\n/**\n * Create path match function from `path-to-regexp` spec.\n */\nexport function match(str, options) {\n    var keys = [];\n    var re = pathToRegexp(str, keys, options);\n    return regexpToFunction(re, keys, options);\n}\n/**\n * Create a path match function from `path-to-regexp` output.\n */\nexport function regexpToFunction(re, keys, options) {\n    if (options === void 0) { options = {}; }\n    var _a = options.decode, decode = _a === void 0 ? function (x) { return x; } : _a;\n    return function (pathname) {\n        var m = re.exec(pathname);\n        if (!m)\n            return false;\n        var path = m[0], index = m.index;\n        var params = Object.create(null);\n        var _loop_1 = function (i) {\n            // tslint:disable-next-line\n            if (m[i] === undefined)\n                return \"continue\";\n            var key = keys[i - 1];\n            if (key.modifier === \"*\" || key.modifier === \"+\") {\n                params[key.name] = m[i].split(key.prefix + key.suffix).map(function (value) {\n                    return decode(value, key);\n                });\n            }\n            else {\n                params[key.name] = decode(m[i], key);\n            }\n        };\n        for (var i = 1; i < m.length; i++) {\n            _loop_1(i);\n        }\n        return { path: path, index: index, params: params };\n    };\n}\n/**\n * Escape a regular expression string.\n */\nfunction escapeString(str) {\n    return str.replace(/([.+*?=^!:${}()[\\]|/\\\\])/g, \"\\\\$1\");\n}\n/**\n * Get the flags for a regexp from the options.\n */\nfunction flags(options) {\n    return options && options.sensitive ? \"\" : \"i\";\n}\n/**\n * Pull out keys from a regexp.\n */\nfunction regexpToRegexp(path, keys) {\n    if (!keys)\n        return path;\n    // Use a negative lookahead to match only capturing groups.\n    var groups = path.source.match(/\\((?!\\?)/g);\n    if (groups) {\n        for (var i = 0; i < groups.length; i++) {\n            keys.push({\n                name: i,\n                prefix: \"\",\n                suffix: \"\",\n                modifier: \"\",\n                pattern: \"\"\n            });\n        }\n    }\n    return path;\n}\n/**\n * Transform an array into a regexp.\n */\nfunction arrayToRegexp(paths, keys, options) {\n    var parts = paths.map(function (path) { return pathToRegexp(path, keys, options).source; });\n    return new RegExp(\"(?:\" + parts.join(\"|\") + \")\", flags(options));\n}\n/**\n * Create a path regexp from string input.\n */\nfunction stringToRegexp(path, keys, options) {\n    return tokensToRegexp(parse(path, options), keys, options);\n}\n/**\n * Expose a function for taking tokens and returning a RegExp.\n */\nexport function tokensToRegexp(tokens, keys, options) {\n    if (options === void 0) { options = {}; }\n    var _a = options.strict, strict = _a === void 0 ? false : _a, _b = options.start, start = _b === void 0 ? true : _b, _c = options.end, end = _c === void 0 ? true : _c, _d = options.encode, encode = _d === void 0 ? function (x) { return x; } : _d;\n    var endsWith = \"[\" + escapeString(options.endsWith || \"\") + \"]|$\";\n    var delimiter = \"[\" + escapeString(options.delimiter || \"/#?\") + \"]\";\n    var route = start ? \"^\" : \"\";\n    // Iterate over the tokens and create our regexp string.\n    for (var _i = 0, tokens_1 = tokens; _i < tokens_1.length; _i++) {\n        var token = tokens_1[_i];\n        if (typeof token === \"string\") {\n            route += escapeString(encode(token));\n        }\n        else {\n            var prefix = escapeString(encode(token.prefix));\n            var suffix = escapeString(encode(token.suffix));\n            if (token.pattern) {\n                if (keys)\n                    keys.push(token);\n                if (prefix || suffix) {\n                    if (token.modifier === \"+\" || token.modifier === \"*\") {\n                        var mod = token.modifier === \"*\" ? \"?\" : \"\";\n                        route += \"(?:\" + prefix + \"((?:\" + token.pattern + \")(?:\" + suffix + prefix + \"(?:\" + token.pattern + \"))*)\" + suffix + \")\" + mod;\n                    }\n                    else {\n                        route += \"(?:\" + prefix + \"(\" + token.pattern + \")\" + suffix + \")\" + token.modifier;\n                    }\n                }\n                else {\n                    route += \"(\" + token.pattern + \")\" + token.modifier;\n                }\n            }\n            else {\n                route += \"(?:\" + prefix + suffix + \")\" + token.modifier;\n            }\n        }\n    }\n    if (end) {\n        if (!strict)\n            route += delimiter + \"?\";\n        route += !options.endsWith ? \"$\" : \"(?=\" + endsWith + \")\";\n    }\n    else {\n        var endToken = tokens[tokens.length - 1];\n        var isEndDelimited = typeof endToken === \"string\"\n            ? delimiter.indexOf(endToken[endToken.length - 1]) > -1\n            : // tslint:disable-next-line\n                endToken === undefined;\n        if (!strict) {\n            route += \"(?:\" + delimiter + \"(?=\" + endsWith + \"))?\";\n        }\n        if (!isEndDelimited) {\n            route += \"(?=\" + delimiter + \"|\" + endsWith + \")\";\n        }\n    }\n    return new RegExp(route, flags(options));\n}\n/**\n * Normalize the given path string, returning a regular expression.\n *\n * An empty array can be passed in for the keys, which will hold the\n * placeholder key descriptions. For example, using `/user/:id`, `keys` will\n * contain `[{ name: 'id', delimiter: '/', optional: false, repeat: false }]`.\n */\nexport function pathToRegexp(path, keys, options) {\n    if (path instanceof RegExp)\n        return regexpToRegexp(path, keys);\n    if (Array.isArray(path))\n        return arrayToRegexp(path, keys, options);\n    return stringToRegexp(path, keys, options);\n}\n//# sourceMappingURL=index.js.map","\nimport { match, compile } from 'path-to-regexp';\nimport { RouteConfig, Route, Match } from './type';\nimport { cleanPath } from './util';\n\n\nexport function addRoute(\n\tcfg: RouteConfig,\n\tnamed: Record<string, Route>,\n\tparent?: Route,\n) {\n\tlet { path, children, alias, meta, component, components, ...p } = cfg;\n\tlet end = !(Array.isArray(children) && children.length);\n\tif (!path || path === '*') {\n\t\tpath = ''\n\t\tend = false;\n\t}\n\tif (path[0] !== '/') {\n\t\tpath = `${parent?.path || ''}/${path}`;\n\t}\n\tpath = cleanPath(path);\n\tif (component) {\n\t\tif (!components) {\n\t\t\tcomponents = {};\n\t\t}\n\t\tcomponents.default = component;\n\t}\n\tconst item: Route = {\n\t\t...p,\n\t\tpath,\n\t\talias,\n\t\tcomponent,\n\t\tcomponents,\n\t\tmeta: meta || {},\n\t\ttoPath: compile(path || '', { encode: encodeURIComponent }),\n\t\tmatch: match(path || '', {end, decode: decodeURIComponent}),\n\t}\n\tif (alias) { named[alias] = item; }\n\tif (Array.isArray(children)) {\n\t\titem.children = children.map(c => addRoute(c, named, item));\n\t}\n\treturn item;\n}\n\nexport function *matchRoutes(path: string, routes: Route[] = []): Iterable<Match>{\n\tfor (const route of routes) {\n\t\tconst result = route.match(path);\n\t\tif (!result) { continue; }\n\t\tif (route.components || route.redirect) {\n\t\t\tyield { ...result, route };\n\t\t}\n\t\tif (!route.redirect) {\n\t\t\tyield* matchRoutes(path, route.children);\n\t\t}\n\t\treturn;\n\t}\n}","\nfunction getValue(v: any): string | undefined | null {\n\tif (v === undefined) { return undefined; }\n\tif (v === null) { return null; }\n\tif (v === false) { return undefined; }\n\tif (typeof v === 'number' && !Number.isFinite(v)) { return; }\n\tif (typeof v === 'function') { return; }\n\treturn encodeURIComponent(String(v));\n}\nexport function stringify(s: any): string {\n\tconst list: string[] = [];\n\tfor (const key of Object.keys(s)) {\n\t\tconst value = s[key];\n\t\tconst k = encodeURIComponent(key);\n\t\tif (!Array.isArray(value)) {\n\t\t\tconst v = getValue(value);\n\t\t\tif (v === undefined) { continue; }\n\t\t\tlist.push(v === null ? k : `${k}=${v}`);\n\t\t\tcontinue;\n\t\t}\n\t\tfor (const val of value) {\n\t\t\tconst v = getValue(val);\n\t\t\tif (v === undefined) { continue; }\n\t\t\tlist.push(v === null ? k : `${k}=${v}`);\n\t\t}\n\t}\n\treturn list.join('&');\n}\n\nexport function parse(s: string): object {\n\tconst query = Object.create(null);\n\tfunction set(k: string, v: null | string = null) {\n\t\tif (!(k in query)) {\n\t\t\tquery[k] = v;\n\t\t\treturn;\n\t\t}\n\t\tconst it = query[k];\n\t\tif (Array.isArray(it)) {\n\t\t\tit.push(v);\n\t\t} else {\n\t\t\tquery[k] = [it, v];\n\t\t}\n\n\t}\n\tfor (const it of s.split('&')) {\n\t\tconst index = it.indexOf('=');\n\t\tif (index < 0) {\n\t\t\tset(decodeURIComponent(it));\n\t\t\tcontinue;\n\t\t}\n\t\tconst k = decodeURIComponent(it.substr(0, index));\n\t\tconst v = decodeURIComponent(it.substr(index + 1));\n\t\tset(k, v);\n\t}\n\treturn query;\n}","import { IHistory } from '../type';\nimport Router from '../Router';\nimport { Auxiliary, Context } from '@neep/core';\n\nexport default class StoreHistory implements IHistory {\n\trouter: Router;\n\tconstructor(router: Router) {\n\t\tthis.router = router;\n\t}\n\tindex = 0;\n\thistory: [string, string, string, any][] = [];\n\tpush(\n\t\tpath: string,\n\t\tsearch: string,\n\t\thash: string,\n\t\tstate: any,\n\t) {\n\t\tthis.history.length = this.index + 1;\n\t\tthis.index++;\n\t\tthis.history.push([path, search, hash, state]);\n\t}\n\treplace(\n\t\tpath: string,\n\t\tsearch: string,\n\t\thash: string,\n\t\tstate: any,\n\t) {\n\t\tthis.history[this.index] = [path, search, hash, state];\n\t}\n\tgo(index: number) {\n\t\tlet newIndex = this.index + index;\n\t\tif (newIndex >= this.history.length) { return; }\n\t\tif (newIndex < 0) { return; }\n\t\tif (newIndex === this.index) { return; }\n\t\tthis.index = newIndex;\n\t\treturn this.history[newIndex];\n\t}\n\tback() {\n\t\treturn this.go(-1);\n\t}\n\tforward() {\n\t\treturn this.go(1);\n\t}\n\tlink(\n\t\tprops: any,\n\t\t{ childNodes }: Context,\n\t\t{ createElement }: Auxiliary,\n\t\tonClick: ()=> void,\n\t) {\n\t\treturn createElement('span', { onClick }, ...childNodes);\n\t}\n}","import { IHistory, Location } from '../type';\nimport Router from '../Router';\nimport { cleanPath } from '../util';\nimport { Context, Auxiliary } from '@neep/core';\n\nexport default class WebPathHistory implements IHistory {\n\treadonly router: Router;\n\treadonly base: string;\n\tconstructor(router: Router, opt?: {\n\t\tbase?: string;\n\t}) {\n\t\tthis.router = router;\n\t\tlet base = cleanPath(opt?.base || '')\n\t\tthis.base = base === '/' ? '' : base;\n\t\tconst f = () => {\n\t\t\tthis.router._update(\n\t\t\t\tthis.getPath(),\n\t\t\t\tlocation.search,\n\t\t\t\tlocation.hash,\n\t\t\t\thistory.state,\n\t\t\t);\n\t\t}\n\t\twindow.addEventListener('popstate', f);\n\t\tthis.destroy = () => {\n\t\t\tthis.destroy = () => {};\n\t\t\twindow.removeEventListener('popstate', f);\n\t\t}\n\t}\n\tstart() {\n\t\tthis.router._update(\n\t\t\tthis.getPath(),\n\t\t\tlocation.search,\n\t\t\tlocation.hash,\n\t\t\thistory.state,\n\t\t);\n\t}\n\tdestroy() {}\n\tpush(\n\t\tpath: string,\n\t\tsearch: string,\n\t\thash: string,\n\t\tstate: any,\n\t) {\n\t\thistory.pushState(state, '', `${this.base}${path}${search}${hash}`);\n\t}\n\treplace(\n\t\tpath: string,\n\t\tsearch: string,\n\t\thash: string,\n\t\tstate: any,\n\t) {\n\t\thistory.replaceState(state, '', `${this.base}${path}${search}${hash}`);\n\t}\n\tprivate getPath() {\n\t\tconst path = location.pathname;\n\t\tconst { base } = this;\n\t\tif (!base) { return path; }\n\t\tif (path.indexOf(`${base}/`) !== 0) { return path; }\n\t\treturn path.substr(base.length);\n\t}\n\tgo(index: number) {\n\t\tconst old = {\n\t\t\tpath: this.getPath(),\n\t\t\tsearch: location.search,\n\t\t\thash: location.hash,\n\t\t\tstate: history.state,\n\t\t}\n\t\thistory.go(index);\n\t\tconst path = this.getPath();\n\t\tconst search = location.search;\n\t\tconst hash = location.hash;\n\t\tconst state = history.state;\n\t\tif (\n\t\t\tpath !== old.path\n\t\t\t|| search !== old.search\n\t\t\t|| hash !== old.hash\n\t\t\t|| state !== old.state\n\t\t) {\n\t\t\treturn [path, search, hash, state] as [string, string, string, any];\n\t\t}\n\t}\n\tback() {\n\t\treturn this.go(-1);\n\t}\n\tforward() {\n\t\treturn this.go(1);\n\t}\n\tlink(\n\t\t{to}: { to: Location },\n\t\t{ childNodes }: Context,\n\t\t{createElement}: Auxiliary,\n\t\tonClick: ()=> void,\n\t) {\n\t\treturn createElement('a', {\n\t\t\thref: `${this.base}${this.router.getUrl(to)}`,\n\t\t\tonClick: (e: MouseEvent) => {\n\t\t\t\te.preventDefault(); onClick();\n\t\t\t}\n\t\t}, ...childNodes);\n\t}\n}","import { IHistory, Location } from '../type';\nimport Router from '../Router';\nimport { Context, Auxiliary } from '@neep/core';\n\nfunction parse(p: string): [string, string, string] {\n\tconst result = /^([^?#]*)((?:\\?[^#]*)?)((?:#.*)?)$/.exec(p);\n\tif (!result) { return ['/', '', '']; }\n\treturn [result[1] || '/', result[2], result[3]];\n}\n\nexport default class WebPathHistory implements IHistory {\n\trouter: Router;\n\tconstructor(router: Router) {\n\t\tthis.router = router;\n\t\tconst f = () => {\n\t\t\tconst [path, search, hash] = parse(location.hash.substr(1));\n\t\t\tthis.router._update(path, search, hash);\n\t\t}\n\t\twindow.addEventListener('hashchange', f);\n\t\tthis.destroy = () => {\n\t\t\tthis.destroy = () => {};\n\t\t\twindow.removeEventListener('hashchange', f);\n\t\t}\n\t}\n\tstart() {\n\t\tconst [path, search, hash] = parse(location.hash.substr(1));\n\t\tthis.router._update(path, search, hash);\n\t}\n\tdestroy() {}\n\tpush(path: string, search: string, hash: string) {\n\t\tlocation.hash = `#${path}${search}${hash}`;\n\t}\n\treplace(path: string, search: string, hash: string) {\n\t\tlocation.replace(`#${path}${search}${hash}`);\n\t}\n\tgo(index: number) {\n\t\tconst oldHash = location.hash;\n\t\thistory.go(index);\n\t\tconst hash = location.hash;\n\t\tif (hash === oldHash) { return; }\n\t\treturn [...parse(hash.substr(1)), undefined] as [string, string, string, any];\n\t}\n\tback() {\n\t\treturn this.go(-1);\n\t}\n\tforward() {\n\t\treturn this.go(1);\n\t}\n\tlink(\n\t\t{to}: { to: Location },\n\t\t{ childNodes }: Context,\n\t\t{createElement}: Auxiliary,\n\t\tonClick: ()=> void,\n\t) {\n\t\treturn createElement('a', {\n\t\t\thref: `#${this.router.getUrl(to)}`,\n\t\t\tonClick: (e: MouseEvent) => {\n\t\t\t\te.preventDefault(); onClick();\n\t\t\t}\n\t\t}, ...childNodes);\n\t}\n}","import install, { Neep } from './install';\nimport { Value } from 'monitorable';\nimport RouterView from './View';\nimport RouterLink from './Link';\nimport { Route, Location, IHistory, Match, RouteConfig } from './type';\nimport { cleanPath } from './util';\nimport { addRoute, matchRoutes } from './route';\nimport { stringify, parse } from './query';\nimport * as history from './history';\nimport { Component, mSimple, mName } from '@neep/core';\n\nfunction get(\n\tlocation: Location | string,\n\troutes: Record<string, Route>,\n\tbasePath: string,\n\tstringifyQuery = stringify,\n): {\n\tpath: string;\n\tsearch: string;\n\thash: string;\n} {\n\tif (typeof location === 'string') { location = { path: location }; }\n\n\tconst route = location.alias && routes[location.alias];\n\tconst result = location.path && /^([^?#]*)((?:\\?[^#]*)?)((?:#.*)?)$/\n\t\t.exec(location.path);\n\tlet path = result?.[1] || '';\n\tif (!path) {\n\t\tpath = route ? route.toPath(location.params || {}) : basePath;\n\t} else if (route) {\n\t\tlet routePath = route.toPath(location.params || {});\n\t\tif (!location.append) {\n\t\t\troutePath = routePath.replace(/\\/[^/]*\\/?$/, '');\n\t\t}\n\t\tpath = `${route.toPath(location.params || {})}/${path}`;\n\t} else if (location.append) {\n\t\tpath = `${basePath}/${path}`;\n\t} if (path[0] !== '/') {\n\t\tpath = `${basePath.replace(/\\/[^/]*\\/?$/, '')}/${path}`;\n\t}\n\tpath = cleanPath(path);\n\tconst search = location.query && `?${ stringifyQuery(location.query) }`\n\t\t|| location.search || result?.[2] || '';\n\tconst hash = location.hash || result?.[3] || '';\n\treturn { path, search, hash };\n}\n\nfunction update(\n\tobj: any,\n\tprops: any = {},\n) {\n\tconst newKeys = new Set(Reflect.ownKeys(props));\n\tfor (const k of Reflect.ownKeys(obj)) {\n\t\tif (!newKeys.has(k)) {\n\t\t\tdelete obj[k];\n\t\t}\n\t}\n\tfor (const k of newKeys) {\n\t\tobj[k] = props[k];\n\t}\n\treturn obj;\n}\nconst redirects: string[] = [];\nclass Router {\n\tstatic get history() { return history; }\n\tstatic get install() { return install; }\n\tstatic get View() { return RouterView; }\n\tstatic get Link() { return RouterLink; }\n\tstringify?(query: Record<any, any>): string;\n\tparse?(search: string): Record<any, any>;\n\tprivate _namedRoutes: Record<string, Route> = Object.create(null);\n\tprivate _routes: Route[] = [];\n\thistory?: IHistory;\n\tprivate readonly _size = Neep.value(0);\n\tprivate readonly _nodes: Value<Match | undefined>[] = [];\n\tprivate readonly _matches = Neep.value<Match[]>([]);\n\tprivate readonly _hash = Neep.value('');\n\tprivate readonly _search = Neep.value('');\n\tprivate readonly _alias = Neep.value('');\n\tprivate readonly _path = Neep.value('/');\n\tprivate readonly _state = Neep.value(undefined as any);\n\tget size() { return this._size(); }\n\tget matches() { return this._matches(); }\n\tget alias() { return this._alias(); }\n\tget path(): string { return this._path(); }\n\tget search() { return this._search(); }\n\tget hash() { return this._hash(); }\n\tget state() { return this._state(); }\n\treadonly params: Record<string, string> = Neep.encase(Object.create(null));\n\treadonly query: Record<string, any> = Neep.encase(Object.create(null));\n\treadonly meta: Record<string, any> = Neep.encase(Object.create(null));\n\tconstructor({History, historyOption}: {\n\t\tHistory?: {new(router: Router, opt?: any): IHistory }\n\t\thistoryOption?: any;\n\t}) {\n\t\tif (History) {\n\t\t\tconst history = new History(this, historyOption);\n\t\t\tthis.history = history;\n\t\t\thistory.start?.();\n\t\t}\n\t}\n\tsetRoutes(routes: RouteConfig[]) {\n\t\tconst named = Object.create(null);\n\t\tthis._routes = routes.map(c => addRoute(c, named));\n\t\tthis._namedRoutes = named;\n\t\tthis._update(\n\t\t\tthis._path(),\n\t\t\tthis._search(),\n\t\t\tthis._hash(),\n\t\t\tthis._state(),\n\t\t\ttrue,\n\t\t);\n\t}\n\t_get(index: number): Match | undefined {\n\t\tconst item =  this._nodes[index]?.();\n\t\tif (!item) {\n\t\t\tthis._size();\n\t\t\treturn undefined;\n\t\t}\n\t\treturn item;\n\t}\n\t_update(path: string, search: string, hash: string, state?: any, force = false) {\n\t\tif (this._path() !== path || force) {\n\t\t\tconst matches = [...matchRoutes(path, this._routes)];\n\t\t\tconst last = matches[matches.length - 1] as Match | undefined;\n\t\t\tif (last && !last.route.components) {\n\t\t\t\tredirects.push(path);\n\t\t\t\tif (redirects.length >= 10) {\n\t\t\t\t\tthrow new Neep.Error(\n\t\t\t\t\t\t`Too many consecutive redirect jumps: \\n${\n\t\t\t\t\t\t\tredirects.join('\\n')\n\t\t\t\t\t\t}`,\n\t\t\t\t\t\t'router',\n\t\t\t\t\t)\n\t\t\t\t}\n\t\t\t\tconst {redirect, append} = last.route;\n\t\t\t\ttry {\n\t\t\t\t\tthis.replace(\n\t\t\t\t\t\t`${path}${append ? '/' : '/../'}${redirect}`,\n\t\t\t\t\t\tstate);\n\t\t\t\t\treturn ;\n\t\t\t\t} finally {\n\t\t\t\t\tredirects.pop();\n\t\t\t\t}\n\t\t\t}\n\t\t\tconst nodes = this._nodes;\n\t\t\tconst nodesLength = nodes.length;\n\t\t\tconst matchesLength = matches.length;\n\t\t\tconst min = Math.min(matchesLength, nodesLength);\n\t\t\tfor (let i = 0; i < min; i++) { nodes[i](matches[i]); }\n\t\t\tfor (let i = min; i < nodesLength; i++) {\n\t\t\t\tnodes[i](undefined);\n\t\t\t}\n\t\t\tfor (let i = min; i < matchesLength; i++) {\n\t\t\t\tnodes[i] = Neep.value(matches[i]);\n\t\t\t}\n\t\t\tnodes.length = matchesLength;\n\t\t\tthis._size(matchesLength);\n\t\t\tthis._matches(matches);\n\t\t\tthis._path(path);\n\t\t\tthis._alias(last?.route?.alias || '');\n\t\t\tupdate(this.params, last?.params || {});\n\t\t\tupdate(this.meta, last?.route?.meta || {});\n\t\t}\n\t\tif (this._search() !== search) {\n\t\t\tthis._search(search);\n\t\t\tupdate(this.query, (this.parse || parse)(search.substr(1)));\n\t\t}\n\t\tthis._hash(hash);\n\t\tthis._state(state);\n\t}\n\tpush(location: Location | string, state?: any) {\n\t\tconst { path, search, hash } = get(\n\t\t\tlocation,\n\t\t\tthis._namedRoutes,\n\t\t\tthis._path(),\n\t\t\tthis.stringify,\n\t\t)\n\t\tthis.history?.push(path, search, hash, state);\n\t\tthis._update(path, search, hash, state);\n\t}\n\treplace(location: Location | string, state?: any) {\n\t\tconst {path, search, hash} = get(\n\t\t\tlocation,\n\t\t\tthis._namedRoutes,\n\t\t\tthis._path(),\n\t\t\tthis.stringify,\n\t\t)\n\t\tthis.history?.replace(path, search, hash, state);\n\t\tthis._update(path, search, hash, state);\n\t}\n\tgetUrl(location: Location | string) {\n\t\tconst {path, search, hash} = get(\n\t\t\tlocation,\n\t\t\tthis._namedRoutes,\n\t\t\tthis._path(),\n\t\t\tthis.stringify,\n\t\t)\n\t\treturn `${path}${search}${hash}`\n\n\t}\n\tgo(index: number) {\n\t\tconst it = this.history?.go(index);\n\t\tif (!it) { return; }\n\t\tthis._update(...it);\n\t}\n\tback() {\n\t\tconst it = this.history?.back();\n\t\tif (!it) { return; }\n\t\tthis._update(...it);\n\t}\n\tforward() {\n\t\tconst it = this.history?.forward();\n\t\tif (!it) { return; }\n\t\tthis._update(...it);\n\t}\n\tget view() {\n\t\tconst view: Component = (props, ...p) =>\n\t\t\tRouterView({...props, router: this}, ...p);\n\t\tNeep.mName('Router', view);\n\t\tReflect.defineProperty(this, 'view', {\n\t\t\tvalue: view,\n\t\t\tenumerable: true,\n\t\t\tconfigurable: true,\n\t\t})\n\t\treturn view;\n\t}\n}\n\nexport default Router;"],"names":["contextConstructor","context","router","delivered","__NeepRouter__","depth","__RouteDepth__","Reflect","defineProperty","value","enumerable","configurable","get","_get","Neep","install","neep","addContextConstructor","RouterView","props","createElement","Deliver","label","isNew","Router","Number","isInteger","size","match","route","components","name","component","undefined","path","mSimple","mName","RouterLink","auxiliary","childNodes","to","append","replace","search","hash","query","alias","params","onclick","push","history","link","cleanPath","test","addRoute","cfg","named","parent","children","meta","p","end","Array","isArray","length","default","item","toPath","compile","encode","encodeURIComponent","decode","decodeURIComponent","map","c","matchRoutes","routes","result","redirect","getValue","v","isFinite","String","stringify","s","list","key","Object","keys","k","val","join","parse","create","set","it","split","index","indexOf","substr","StoreHistory","constructor","state","go","newIndex","back","forward","onClick","WebPathHistory","opt","base","f","_update","getPath","location","window","addEventListener","destroy","removeEventListener","start","pushState","replaceState","pathname","old","href","getUrl","e","preventDefault","exec","oldHash","basePath","stringifyQuery","routePath","update","obj","newKeys","Set","ownKeys","has","redirects","View","Link","_size","matches","_matches","_alias","_path","_search","_hash","_state","History","historyOption","encase","setRoutes","_routes","_namedRoutes","_nodes","force","last","Error","pop","nodes","nodesLength","matchesLength","min","Math","i","view"],"mappings":"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"}