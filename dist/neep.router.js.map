{"version":3,"file":"neep.router.js","sources":["../src/install/context.ts","../src/install/index.ts","../src/View.ts","../src/Link.ts","../src/util.ts","../node_modules/path-to-regexp/dist.es2015/index.js","../src/route.ts","../src/query.ts","../src/history/Memory.ts","../src/history/WebPath.ts","../src/history/WebHash.ts","../src/Router.ts","../src/browser.ts"],"sourcesContent":["import { Context } from '@neep/core';\n\nexport default function contextConstructor(context: Context) {\n\tconst router = context.delivered.__NeepRouter__;\n\tconst depth = context.delivered.__RouteDepth__ || 0;\n\tReflect.defineProperty(context, 'route', {\n\t\tvalue: router,\n\t\tenumerable: true,\n\t\tconfigurable: true,\n\t});\n\tReflect.defineProperty(context, 'match', {\n\t\tget: () => router?._get(depth),\n\t\tenumerable: true,\n\t\tconfigurable: true,\n\t});\n}","import contextConstructor from './context';\n\nexport let Neep: typeof import ('@neep/core');\nexport default function install(neep: typeof import ('@neep/core')) {\n\tNeep = neep;\n\tNeep.addContextConstructor(contextConstructor);\n}","import { Context, Auxiliary, mName, mSimple } from '@neep/core';\nimport Router from './Router';\nexport default function RouterView(\n\tprops: {name?: string; depth?: number; router?: Router},\n\t{ delivered }: Context,\n\t{ createElement, Deliver, label }: Auxiliary,\n) {\n\tconst isNew = props.router instanceof Router;\n\tconst router = isNew ? props.router : delivered.__NeepRouter__;\n\tif (!(router instanceof Router)) { return; }\n\tlet depth = props.depth;\n\tif (typeof depth === 'number' && Number.isInteger(depth)) {\n\t\tif (depth < 0) { depth = router.size - depth; }\n\t} else {\n\t\tdepth = isNew ? 0 : (delivered.__RouteDepth__ || 0) + 1;\n\t}\n\tif (depth < 0) { return null; }\n\tconst match = router._get(depth);\n\tif (!match) { return; }\n\tconst { route: { components } } = match;\n\tif (!components) { return null; }\n\tconst name = props.name || 'default';\n\tconst component = name in components ? components[name] : undefined;\n\tif (!component) { return null; }\n\tlabel(`[path=${match.path}]`, '#987654');\n\treturn createElement(Deliver, {\n\t\t__RouteDepth__: depth,\n\t\t__NeepRouter__: router,\n\t}, createElement(component, props));\n}\nmSimple(RouterView)\nmName('RouterView', RouterView);","import { Context, Auxiliary, mName, mSimple } from '@neep/core';\nimport { Location } from './type';\nexport default function RouterLink(\n\tprops: { to?: Location | string; replace?: boolean} & Location,\n\tcontext: Context,\n\tauxiliary: Auxiliary,\n) {\n\tconst { route, childNodes } = context;\n\tconst { createElement } = auxiliary;\n\t// return null;screenLeft\n\tif (!route) { return createElement('template', {}, ...childNodes); }\n\tlet {to, append, replace, path, search, hash, query, alias, params} = props;\n\tif (!to) {\n\t\tto = { path, search, hash, query, alias, params };\n\t} else if (typeof to === 'string') {\n\t\tto = { path: to };\n\t}\n\tif (append) {\n\t\tto.append = true;\n\t}\n\tfunction onclick() {\n\t\tif (!route || !to) { return; }\n\t\tif (replace) {\n\t\t\troute.replace(to);\n\t\t} else {\n\t\t\troute.push(to);\n\t\t}\n\t}\n\treturn route\n\t\t.history?.link({...props, to}, context, auxiliary, onclick)\n\t\t|| createElement('span', {onclick}, ...childNodes);\n\n}\nmSimple(RouterLink)\nmName('RouterView', RouterLink);","export function cleanPath(path: string) {\n\tpath = `/${path}`.replace(/\\/+(\\/|$)/g, '$1');\n\twhile(/[^/]+\\/\\.{2,}(\\/|$)/.test(path)) {\n\t\tpath = path.replace(/\\/[^/]+\\/\\.(\\.+(?:\\/|$))/g, '/$1');\n\t}\n\tpath = path.replace(/\\/\\.+(\\/|$)/g, '$1');\n\treturn path || '/';\n}","/**\n * Tokenize input string.\n */\nfunction lexer(str) {\n    var tokens = [];\n    var i = 0;\n    while (i < str.length) {\n        var char = str[i];\n        if (char === \"*\" || char === \"+\" || char === \"?\") {\n            tokens.push({ type: \"MODIFIER\", index: i, value: str[i++] });\n            continue;\n        }\n        if (char === \"\\\\\") {\n            tokens.push({ type: \"ESCAPED_CHAR\", index: i++, value: str[i++] });\n            continue;\n        }\n        if (char === \"{\") {\n            tokens.push({ type: \"OPEN\", index: i, value: str[i++] });\n            continue;\n        }\n        if (char === \"}\") {\n            tokens.push({ type: \"CLOSE\", index: i, value: str[i++] });\n            continue;\n        }\n        if (char === \":\") {\n            var name = \"\";\n            var j = i + 1;\n            while (j < str.length) {\n                var code = str.charCodeAt(j);\n                if (\n                // `0-9`\n                (code >= 48 && code <= 57) ||\n                    // `A-Z`\n                    (code >= 65 && code <= 90) ||\n                    // `a-z`\n                    (code >= 97 && code <= 122) ||\n                    // `_`\n                    code === 95) {\n                    name += str[j++];\n                    continue;\n                }\n                break;\n            }\n            if (!name)\n                throw new TypeError(\"Missing parameter name at \" + i);\n            tokens.push({ type: \"NAME\", index: i, value: name });\n            i = j;\n            continue;\n        }\n        if (char === \"(\") {\n            var count = 1;\n            var pattern = \"\";\n            var j = i + 1;\n            if (str[j] === \"?\") {\n                throw new TypeError(\"Pattern cannot start with \\\"?\\\" at \" + j);\n            }\n            while (j < str.length) {\n                if (str[j] === \"\\\\\") {\n                    pattern += str[j++] + str[j++];\n                    continue;\n                }\n                if (str[j] === \")\") {\n                    count--;\n                    if (count === 0) {\n                        j++;\n                        break;\n                    }\n                }\n                else if (str[j] === \"(\") {\n                    count++;\n                    if (str[j + 1] !== \"?\") {\n                        throw new TypeError(\"Capturing groups are not allowed at \" + j);\n                    }\n                }\n                pattern += str[j++];\n            }\n            if (count)\n                throw new TypeError(\"Unbalanced pattern at \" + i);\n            if (!pattern)\n                throw new TypeError(\"Missing pattern at \" + i);\n            tokens.push({ type: \"PATTERN\", index: i, value: pattern });\n            i = j;\n            continue;\n        }\n        tokens.push({ type: \"CHAR\", index: i, value: str[i++] });\n    }\n    tokens.push({ type: \"END\", index: i, value: \"\" });\n    return tokens;\n}\n/**\n * Parse a string for the raw tokens.\n */\nexport function parse(str, options) {\n    if (options === void 0) { options = {}; }\n    var tokens = lexer(str);\n    var _a = options.prefixes, prefixes = _a === void 0 ? \"./\" : _a;\n    var defaultPattern = \"[^\" + escapeString(options.delimiter || \"/#?\") + \"]+?\";\n    var result = [];\n    var key = 0;\n    var i = 0;\n    var path = \"\";\n    var tryConsume = function (type) {\n        if (i < tokens.length && tokens[i].type === type)\n            return tokens[i++].value;\n    };\n    var mustConsume = function (type) {\n        var value = tryConsume(type);\n        if (value !== undefined)\n            return value;\n        var _a = tokens[i], nextType = _a.type, index = _a.index;\n        throw new TypeError(\"Unexpected \" + nextType + \" at \" + index + \", expected \" + type);\n    };\n    var consumeText = function () {\n        var result = \"\";\n        var value;\n        // tslint:disable-next-line\n        while ((value = tryConsume(\"CHAR\") || tryConsume(\"ESCAPED_CHAR\"))) {\n            result += value;\n        }\n        return result;\n    };\n    while (i < tokens.length) {\n        var char = tryConsume(\"CHAR\");\n        var name = tryConsume(\"NAME\");\n        var pattern = tryConsume(\"PATTERN\");\n        if (name || pattern) {\n            var prefix = char || \"\";\n            if (prefixes.indexOf(prefix) === -1) {\n                path += prefix;\n                prefix = \"\";\n            }\n            if (path) {\n                result.push(path);\n                path = \"\";\n            }\n            result.push({\n                name: name || key++,\n                prefix: prefix,\n                suffix: \"\",\n                pattern: pattern || defaultPattern,\n                modifier: tryConsume(\"MODIFIER\") || \"\"\n            });\n            continue;\n        }\n        var value = char || tryConsume(\"ESCAPED_CHAR\");\n        if (value) {\n            path += value;\n            continue;\n        }\n        if (path) {\n            result.push(path);\n            path = \"\";\n        }\n        var open = tryConsume(\"OPEN\");\n        if (open) {\n            var prefix = consumeText();\n            var name_1 = tryConsume(\"NAME\") || \"\";\n            var pattern_1 = tryConsume(\"PATTERN\") || \"\";\n            var suffix = consumeText();\n            mustConsume(\"CLOSE\");\n            result.push({\n                name: name_1 || (pattern_1 ? key++ : \"\"),\n                pattern: name_1 && !pattern_1 ? defaultPattern : pattern_1,\n                prefix: prefix,\n                suffix: suffix,\n                modifier: tryConsume(\"MODIFIER\") || \"\"\n            });\n            continue;\n        }\n        mustConsume(\"END\");\n    }\n    return result;\n}\n/**\n * Compile a string to a template function for the path.\n */\nexport function compile(str, options) {\n    return tokensToFunction(parse(str, options), options);\n}\n/**\n * Expose a method for transforming tokens into the path function.\n */\nexport function tokensToFunction(tokens, options) {\n    if (options === void 0) { options = {}; }\n    var reFlags = flags(options);\n    var _a = options.encode, encode = _a === void 0 ? function (x) { return x; } : _a, _b = options.validate, validate = _b === void 0 ? true : _b;\n    // Compile all the tokens into regexps.\n    var matches = tokens.map(function (token) {\n        if (typeof token === \"object\") {\n            return new RegExp(\"^(?:\" + token.pattern + \")$\", reFlags);\n        }\n    });\n    return function (data) {\n        var path = \"\";\n        for (var i = 0; i < tokens.length; i++) {\n            var token = tokens[i];\n            if (typeof token === \"string\") {\n                path += token;\n                continue;\n            }\n            var value = data ? data[token.name] : undefined;\n            var optional = token.modifier === \"?\" || token.modifier === \"*\";\n            var repeat = token.modifier === \"*\" || token.modifier === \"+\";\n            if (Array.isArray(value)) {\n                if (!repeat) {\n                    throw new TypeError(\"Expected \\\"\" + token.name + \"\\\" to not repeat, but got an array\");\n                }\n                if (value.length === 0) {\n                    if (optional)\n                        continue;\n                    throw new TypeError(\"Expected \\\"\" + token.name + \"\\\" to not be empty\");\n                }\n                for (var j = 0; j < value.length; j++) {\n                    var segment = encode(value[j], token);\n                    if (validate && !matches[i].test(segment)) {\n                        throw new TypeError(\"Expected all \\\"\" + token.name + \"\\\" to match \\\"\" + token.pattern + \"\\\", but got \\\"\" + segment + \"\\\"\");\n                    }\n                    path += token.prefix + segment + token.suffix;\n                }\n                continue;\n            }\n            if (typeof value === \"string\" || typeof value === \"number\") {\n                var segment = encode(String(value), token);\n                if (validate && !matches[i].test(segment)) {\n                    throw new TypeError(\"Expected \\\"\" + token.name + \"\\\" to match \\\"\" + token.pattern + \"\\\", but got \\\"\" + segment + \"\\\"\");\n                }\n                path += token.prefix + segment + token.suffix;\n                continue;\n            }\n            if (optional)\n                continue;\n            var typeOfMessage = repeat ? \"an array\" : \"a string\";\n            throw new TypeError(\"Expected \\\"\" + token.name + \"\\\" to be \" + typeOfMessage);\n        }\n        return path;\n    };\n}\n/**\n * Create path match function from `path-to-regexp` spec.\n */\nexport function match(str, options) {\n    var keys = [];\n    var re = pathToRegexp(str, keys, options);\n    return regexpToFunction(re, keys, options);\n}\n/**\n * Create a path match function from `path-to-regexp` output.\n */\nexport function regexpToFunction(re, keys, options) {\n    if (options === void 0) { options = {}; }\n    var _a = options.decode, decode = _a === void 0 ? function (x) { return x; } : _a;\n    return function (pathname) {\n        var m = re.exec(pathname);\n        if (!m)\n            return false;\n        var path = m[0], index = m.index;\n        var params = Object.create(null);\n        var _loop_1 = function (i) {\n            // tslint:disable-next-line\n            if (m[i] === undefined)\n                return \"continue\";\n            var key = keys[i - 1];\n            if (key.modifier === \"*\" || key.modifier === \"+\") {\n                params[key.name] = m[i].split(key.prefix + key.suffix).map(function (value) {\n                    return decode(value, key);\n                });\n            }\n            else {\n                params[key.name] = decode(m[i], key);\n            }\n        };\n        for (var i = 1; i < m.length; i++) {\n            _loop_1(i);\n        }\n        return { path: path, index: index, params: params };\n    };\n}\n/**\n * Escape a regular expression string.\n */\nfunction escapeString(str) {\n    return str.replace(/([.+*?=^!:${}()[\\]|/\\\\])/g, \"\\\\$1\");\n}\n/**\n * Get the flags for a regexp from the options.\n */\nfunction flags(options) {\n    return options && options.sensitive ? \"\" : \"i\";\n}\n/**\n * Pull out keys from a regexp.\n */\nfunction regexpToRegexp(path, keys) {\n    if (!keys)\n        return path;\n    // Use a negative lookahead to match only capturing groups.\n    var groups = path.source.match(/\\((?!\\?)/g);\n    if (groups) {\n        for (var i = 0; i < groups.length; i++) {\n            keys.push({\n                name: i,\n                prefix: \"\",\n                suffix: \"\",\n                modifier: \"\",\n                pattern: \"\"\n            });\n        }\n    }\n    return path;\n}\n/**\n * Transform an array into a regexp.\n */\nfunction arrayToRegexp(paths, keys, options) {\n    var parts = paths.map(function (path) { return pathToRegexp(path, keys, options).source; });\n    return new RegExp(\"(?:\" + parts.join(\"|\") + \")\", flags(options));\n}\n/**\n * Create a path regexp from string input.\n */\nfunction stringToRegexp(path, keys, options) {\n    return tokensToRegexp(parse(path, options), keys, options);\n}\n/**\n * Expose a function for taking tokens and returning a RegExp.\n */\nexport function tokensToRegexp(tokens, keys, options) {\n    if (options === void 0) { options = {}; }\n    var _a = options.strict, strict = _a === void 0 ? false : _a, _b = options.start, start = _b === void 0 ? true : _b, _c = options.end, end = _c === void 0 ? true : _c, _d = options.encode, encode = _d === void 0 ? function (x) { return x; } : _d;\n    var endsWith = \"[\" + escapeString(options.endsWith || \"\") + \"]|$\";\n    var delimiter = \"[\" + escapeString(options.delimiter || \"/#?\") + \"]\";\n    var route = start ? \"^\" : \"\";\n    // Iterate over the tokens and create our regexp string.\n    for (var _i = 0, tokens_1 = tokens; _i < tokens_1.length; _i++) {\n        var token = tokens_1[_i];\n        if (typeof token === \"string\") {\n            route += escapeString(encode(token));\n        }\n        else {\n            var prefix = escapeString(encode(token.prefix));\n            var suffix = escapeString(encode(token.suffix));\n            if (token.pattern) {\n                if (keys)\n                    keys.push(token);\n                if (prefix || suffix) {\n                    if (token.modifier === \"+\" || token.modifier === \"*\") {\n                        var mod = token.modifier === \"*\" ? \"?\" : \"\";\n                        route += \"(?:\" + prefix + \"((?:\" + token.pattern + \")(?:\" + suffix + prefix + \"(?:\" + token.pattern + \"))*)\" + suffix + \")\" + mod;\n                    }\n                    else {\n                        route += \"(?:\" + prefix + \"(\" + token.pattern + \")\" + suffix + \")\" + token.modifier;\n                    }\n                }\n                else {\n                    route += \"(\" + token.pattern + \")\" + token.modifier;\n                }\n            }\n            else {\n                route += \"(?:\" + prefix + suffix + \")\" + token.modifier;\n            }\n        }\n    }\n    if (end) {\n        if (!strict)\n            route += delimiter + \"?\";\n        route += !options.endsWith ? \"$\" : \"(?=\" + endsWith + \")\";\n    }\n    else {\n        var endToken = tokens[tokens.length - 1];\n        var isEndDelimited = typeof endToken === \"string\"\n            ? delimiter.indexOf(endToken[endToken.length - 1]) > -1\n            : // tslint:disable-next-line\n                endToken === undefined;\n        if (!strict) {\n            route += \"(?:\" + delimiter + \"(?=\" + endsWith + \"))?\";\n        }\n        if (!isEndDelimited) {\n            route += \"(?=\" + delimiter + \"|\" + endsWith + \")\";\n        }\n    }\n    return new RegExp(route, flags(options));\n}\n/**\n * Normalize the given path string, returning a regular expression.\n *\n * An empty array can be passed in for the keys, which will hold the\n * placeholder key descriptions. For example, using `/user/:id`, `keys` will\n * contain `[{ name: 'id', delimiter: '/', optional: false, repeat: false }]`.\n */\nexport function pathToRegexp(path, keys, options) {\n    if (path instanceof RegExp)\n        return regexpToRegexp(path, keys);\n    if (Array.isArray(path))\n        return arrayToRegexp(path, keys, options);\n    return stringToRegexp(path, keys, options);\n}\n//# sourceMappingURL=index.js.map","\nimport { match, compile } from 'path-to-regexp';\nimport { RouteConfig, Route, Match } from './type';\nimport { cleanPath } from './util';\n\n\nexport function addRoute(\n\tcfg: RouteConfig,\n\tnamed: Record<string, Route>,\n\tparent?: Route,\n) {\n\tlet { path, children, alias, meta, component, components, ...p } = cfg;\n\tlet end = !(Array.isArray(children) && children.length);\n\tif (!path || path === '*') {\n\t\tpath = ''\n\t\tend = false;\n\t}\n\tif (path[0] !== '/') {\n\t\tpath = `${parent?.path || ''}/${path}`;\n\t}\n\tpath = cleanPath(path);\n\tif (component) {\n\t\tif (!components) {\n\t\t\tcomponents = {};\n\t\t}\n\t\tcomponents.default = component;\n\t}\n\tconst item: Route = {\n\t\t...p,\n\t\tpath,\n\t\talias,\n\t\tcomponent,\n\t\tcomponents,\n\t\tmeta: meta || {},\n\t\ttoPath: compile(path || '', { encode: encodeURIComponent }),\n\t\tmatch: match(path || '', {end, decode: decodeURIComponent}),\n\t}\n\tif (alias) { named[alias] = item; }\n\tif (Array.isArray(children)) {\n\t\titem.children = children.map(c => addRoute(c, named, item));\n\t}\n\treturn item;\n}\n\nexport function *matchRoutes(path: string, routes: Route[] = []): Iterable<Match>{\n\tfor (const route of routes) {\n\t\tconst result = route.match(path);\n\t\tif (!result) { continue; }\n\t\tif (route.components || route.redirect) {\n\t\t\tyield { ...result, route };\n\t\t}\n\t\tif (!route.redirect) {\n\t\t\tyield* matchRoutes(path, route.children);\n\t\t}\n\t\treturn;\n\t}\n}","\nfunction getValue(v: any): string | undefined | null {\n\tif (v === undefined) { return undefined; }\n\tif (v === null) { return null; }\n\tif (v === false) { return undefined; }\n\tif (typeof v === 'number' && !Number.isFinite(v)) { return; }\n\tif (typeof v === 'function') { return; }\n\treturn encodeURIComponent(String(v));\n}\nexport function stringify(s: any): string {\n\tconst list: string[] = [];\n\tfor (const key of Object.keys(s)) {\n\t\tconst value = s[key];\n\t\tconst k = encodeURIComponent(key);\n\t\tif (!Array.isArray(value)) {\n\t\t\tconst v = getValue(value);\n\t\t\tif (v === undefined) { continue; }\n\t\t\tlist.push(v === null ? k : `${k}=${v}`);\n\t\t\tcontinue;\n\t\t}\n\t\tfor (const val of value) {\n\t\t\tconst v = getValue(val);\n\t\t\tif (v === undefined) { continue; }\n\t\t\tlist.push(v === null ? k : `${k}=${v}`);\n\t\t}\n\t}\n\treturn list.join('&');\n}\n\nexport function parse(s: string): object {\n\tconst query = Object.create(null);\n\tfunction set(k: string, v: null | string = null) {\n\t\tif (!(k in query)) {\n\t\t\tquery[k] = v;\n\t\t\treturn;\n\t\t}\n\t\tconst it = query[k];\n\t\tif (Array.isArray(it)) {\n\t\t\tit.push(v);\n\t\t} else {\n\t\t\tquery[k] = [it, v];\n\t\t}\n\n\t}\n\tfor (const it of s.split('&')) {\n\t\tconst index = it.indexOf('=');\n\t\tif (index < 0) {\n\t\t\tset(decodeURIComponent(it));\n\t\t\tcontinue;\n\t\t}\n\t\tconst k = decodeURIComponent(it.substr(0, index));\n\t\tconst v = decodeURIComponent(it.substr(index + 1));\n\t\tset(k, v);\n\t}\n\treturn query;\n}","import { IHistory } from '../type';\nimport Router from '../Router';\nimport { Auxiliary, Context } from '@neep/core';\n\nexport default class StoreHistory implements IHistory {\n\trouter: Router;\n\tconstructor(router: Router) {\n\t\tthis.router = router;\n\t}\n\tindex = 0;\n\thistory: [string, string, string, any][] = [];\n\tpush(\n\t\tpath: string,\n\t\tsearch: string,\n\t\thash: string,\n\t\tstate: any,\n\t) {\n\t\tthis.history.length = this.index + 1;\n\t\tthis.index++;\n\t\tthis.history.push([path, search, hash, state]);\n\t}\n\treplace(\n\t\tpath: string,\n\t\tsearch: string,\n\t\thash: string,\n\t\tstate: any,\n\t) {\n\t\tthis.history[this.index] = [path, search, hash, state];\n\t}\n\tgo(index: number) {\n\t\tlet newIndex = this.index + index;\n\t\tif (newIndex >= this.history.length) { return; }\n\t\tif (newIndex < 0) { return; }\n\t\tif (newIndex === this.index) { return; }\n\t\tthis.index = newIndex;\n\t\treturn this.history[newIndex];\n\t}\n\tback() {\n\t\treturn this.go(-1);\n\t}\n\tforward() {\n\t\treturn this.go(1);\n\t}\n\tlink(\n\t\tprops: any,\n\t\t{ childNodes }: Context,\n\t\t{ createElement }: Auxiliary,\n\t\tonClick: ()=> void,\n\t) {\n\t\treturn createElement('span', { onClick }, ...childNodes);\n\t}\n}","import { IHistory, Location } from '../type';\nimport Router from '../Router';\nimport { cleanPath } from '../util';\nimport { Context, Auxiliary } from '@neep/core';\n\nexport default class WebPathHistory implements IHistory {\n\treadonly router: Router;\n\treadonly base: string;\n\tconstructor(router: Router, opt?: {\n\t\tbase?: string;\n\t}) {\n\t\tthis.router = router;\n\t\tlet base = cleanPath(opt?.base || '')\n\t\tthis.base = base === '/' ? '' : base;\n\t\tconst f = () => {\n\t\t\tthis.router._update(\n\t\t\t\tthis.getPath(),\n\t\t\t\tlocation.search,\n\t\t\t\tlocation.hash,\n\t\t\t\thistory.state,\n\t\t\t);\n\t\t}\n\t\twindow.addEventListener('popstate', f);\n\t\tthis.destroy = () => {\n\t\t\tthis.destroy = () => {};\n\t\t\twindow.removeEventListener('popstate', f);\n\t\t}\n\t}\n\tstart() {\n\t\tthis.router._update(\n\t\t\tthis.getPath(),\n\t\t\tlocation.search,\n\t\t\tlocation.hash,\n\t\t\thistory.state,\n\t\t);\n\t}\n\tdestroy() {}\n\tpush(\n\t\tpath: string,\n\t\tsearch: string,\n\t\thash: string,\n\t\tstate: any,\n\t) {\n\t\thistory.pushState(state, '', `${this.base}${path}${search}${hash}`);\n\t}\n\treplace(\n\t\tpath: string,\n\t\tsearch: string,\n\t\thash: string,\n\t\tstate: any,\n\t) {\n\t\thistory.replaceState(state, '', `${this.base}${path}${search}${hash}`);\n\t}\n\tprivate getPath() {\n\t\tconst path = location.pathname;\n\t\tconst { base } = this;\n\t\tif (!base) { return path; }\n\t\tif (path.indexOf(`${base}/`) !== 0) { return path; }\n\t\treturn path.substr(base.length);\n\t}\n\tgo(index: number) {\n\t\tconst old = {\n\t\t\tpath: this.getPath(),\n\t\t\tsearch: location.search,\n\t\t\thash: location.hash,\n\t\t\tstate: history.state,\n\t\t}\n\t\thistory.go(index);\n\t\tconst path = this.getPath();\n\t\tconst search = location.search;\n\t\tconst hash = location.hash;\n\t\tconst state = history.state;\n\t\tif (\n\t\t\tpath !== old.path\n\t\t\t|| search !== old.search\n\t\t\t|| hash !== old.hash\n\t\t\t|| state !== old.state\n\t\t) {\n\t\t\treturn [path, search, hash, state] as [string, string, string, any];\n\t\t}\n\t}\n\tback() {\n\t\treturn this.go(-1);\n\t}\n\tforward() {\n\t\treturn this.go(1);\n\t}\n\tlink(\n\t\t{to}: { to: Location },\n\t\t{ childNodes }: Context,\n\t\t{createElement}: Auxiliary,\n\t\tonClick: ()=> void,\n\t) {\n\t\treturn createElement('a', {\n\t\t\thref: `${this.base}${this.router.getUrl(to)}`,\n\t\t\tonClick: (e: MouseEvent) => {\n\t\t\t\te.preventDefault(); onClick();\n\t\t\t}\n\t\t}, ...childNodes);\n\t}\n}","import { IHistory, Location } from '../type';\nimport Router from '../Router';\nimport { Context, Auxiliary } from '@neep/core';\n\nfunction parse(p: string): [string, string, string] {\n\tconst result = /^([^?#]*)((?:\\?[^#]*)?)((?:#.*)?)$/.exec(p);\n\tif (!result) { return ['/', '', '']; }\n\treturn [result[1] || '/', result[2], result[3]];\n}\n\nexport default class WebPathHistory implements IHistory {\n\trouter: Router;\n\tconstructor(router: Router) {\n\t\tthis.router = router;\n\t\tconst f = () => {\n\t\t\tconst [path, search, hash] = parse(location.hash.substr(1));\n\t\t\tthis.router._update(path, search, hash);\n\t\t}\n\t\twindow.addEventListener('hashchange', f);\n\t\tthis.destroy = () => {\n\t\t\tthis.destroy = () => {};\n\t\t\twindow.removeEventListener('hashchange', f);\n\t\t}\n\t}\n\tstart() {\n\t\tconst [path, search, hash] = parse(location.hash.substr(1));\n\t\tthis.router._update(path, search, hash);\n\t}\n\tdestroy() {}\n\tpush(path: string, search: string, hash: string) {\n\t\tlocation.hash = `#${path}${search}${hash}`;\n\t}\n\treplace(path: string, search: string, hash: string) {\n\t\tlocation.replace(`#${path}${search}${hash}`);\n\t}\n\tgo(index: number) {\n\t\tconst oldHash = location.hash;\n\t\thistory.go(index);\n\t\tconst hash = location.hash;\n\t\tif (hash === oldHash) { return; }\n\t\treturn [...parse(hash.substr(1)), undefined] as [string, string, string, any];\n\t}\n\tback() {\n\t\treturn this.go(-1);\n\t}\n\tforward() {\n\t\treturn this.go(1);\n\t}\n\tlink(\n\t\t{to}: { to: Location },\n\t\t{ childNodes }: Context,\n\t\t{createElement}: Auxiliary,\n\t\tonClick: ()=> void,\n\t) {\n\t\treturn createElement('a', {\n\t\t\thref: `#${this.router.getUrl(to)}`,\n\t\t\tonClick: (e: MouseEvent) => {\n\t\t\t\te.preventDefault(); onClick();\n\t\t\t}\n\t\t}, ...childNodes);\n\t}\n}","import install, { Neep } from './install';\nimport { Value } from 'monitorable';\nimport RouterView from './View';\nimport RouterLink from './Link';\nimport { Route, Location, IHistory, Match, RouteConfig } from './type';\nimport { cleanPath } from './util';\nimport { addRoute, matchRoutes } from './route';\nimport { stringify, parse } from './query';\nimport * as history from './history';\nimport { Component, mSimple, mName } from '@neep/core';\n\nfunction get(\n\tlocation: Location | string,\n\troutes: Record<string, Route>,\n\tbasePath: string,\n\tstringifyQuery = stringify,\n): {\n\tpath: string;\n\tsearch: string;\n\thash: string;\n} {\n\tif (typeof location === 'string') { location = { path: location }; }\n\n\tconst route = location.alias && routes[location.alias];\n\tconst result = location.path && /^([^?#]*)((?:\\?[^#]*)?)((?:#.*)?)$/\n\t\t.exec(location.path);\n\tlet path = result?.[1] || '';\n\tif (!path) {\n\t\tpath = route ? route.toPath(location.params || {}) : basePath;\n\t} else if (route) {\n\t\tlet routePath = route.toPath(location.params || {});\n\t\tif (!location.append) {\n\t\t\troutePath = routePath.replace(/\\/[^/]*\\/?$/, '');\n\t\t}\n\t\tpath = `${route.toPath(location.params || {})}/${path}`;\n\t} else if (location.append) {\n\t\tpath = `${basePath}/${path}`;\n\t} if (path[0] !== '/') {\n\t\tpath = `${basePath.replace(/\\/[^/]*\\/?$/, '')}/${path}`;\n\t}\n\tpath = cleanPath(path);\n\tconst search = location.query && `?${ stringifyQuery(location.query) }`\n\t\t|| location.search || result?.[2] || '';\n\tconst hash = location.hash || result?.[3] || '';\n\treturn { path, search, hash };\n}\n\nfunction update(\n\tobj: any,\n\tprops: any = {},\n) {\n\tconst newKeys = new Set(Reflect.ownKeys(props));\n\tfor (const k of Reflect.ownKeys(obj)) {\n\t\tif (!newKeys.has(k)) {\n\t\t\tdelete obj[k];\n\t\t}\n\t}\n\tfor (const k of newKeys) {\n\t\tobj[k] = props[k];\n\t}\n\treturn obj;\n}\nconst redirects: string[] = [];\nclass Router {\n\tstatic get history() { return history; }\n\tstatic get install() { return install; }\n\tstatic get View() { return RouterView; }\n\tstatic get Link() { return RouterLink; }\n\tstringify?(query: Record<any, any>): string;\n\tparse?(search: string): Record<any, any>;\n\tprivate _namedRoutes: Record<string, Route> = Object.create(null);\n\tprivate _routes: Route[] = [];\n\thistory?: IHistory;\n\tprivate readonly _size = Neep.value(0);\n\tprivate readonly _nodes: Value<Match | undefined>[] = [];\n\tprivate readonly _matches = Neep.value<Match[]>([]);\n\tprivate readonly _hash = Neep.value('');\n\tprivate readonly _search = Neep.value('');\n\tprivate readonly _alias = Neep.value('');\n\tprivate readonly _path = Neep.value('/');\n\tprivate readonly _state = Neep.value(undefined as any);\n\tget size() { return this._size(); }\n\tget matches() { return this._matches(); }\n\tget alias() { return this._alias(); }\n\tget path(): string { return this._path(); }\n\tget search() { return this._search(); }\n\tget hash() { return this._hash(); }\n\tget state() { return this._state(); }\n\treadonly params: Record<string, string> = Neep.encase(Object.create(null));\n\treadonly query: Record<string, any> = Neep.encase(Object.create(null));\n\treadonly meta: Record<string, any> = Neep.encase(Object.create(null));\n\tconstructor({History, historyOption}: {\n\t\tHistory?: {new(router: Router, opt?: any): IHistory }\n\t\thistoryOption?: any;\n\t}) {\n\t\tif (History) {\n\t\t\tconst history = new History(this, historyOption);\n\t\t\tthis.history = history;\n\t\t\thistory.start?.();\n\t\t}\n\t}\n\tsetRoutes(routes: RouteConfig[]) {\n\t\tconst named = Object.create(null);\n\t\tthis._routes = routes.map(c => addRoute(c, named));\n\t\tthis._namedRoutes = named;\n\t\tthis._update(\n\t\t\tthis._path(),\n\t\t\tthis._search(),\n\t\t\tthis._hash(),\n\t\t\tthis._state(),\n\t\t\ttrue,\n\t\t);\n\t}\n\t_get(index: number): Match | undefined {\n\t\tconst item =  this._nodes[index]?.();\n\t\tif (!item) {\n\t\t\tthis._size();\n\t\t\treturn undefined;\n\t\t}\n\t\treturn item;\n\t}\n\t_update(path: string, search: string, hash: string, state?: any, force = false) {\n\t\tif (this._path() !== path || force) {\n\t\t\tconst matches = [...matchRoutes(path, this._routes)];\n\t\t\tconst last = matches[matches.length - 1] as Match | undefined;\n\t\t\tif (last && !last.route.components) {\n\t\t\t\tredirects.push(path);\n\t\t\t\tif (redirects.length >= 10) {\n\t\t\t\t\tthrow new Neep.Error(\n\t\t\t\t\t\t`Too many consecutive redirect jumps: \\n${\n\t\t\t\t\t\t\tredirects.join('\\n')\n\t\t\t\t\t\t}`,\n\t\t\t\t\t\t'router',\n\t\t\t\t\t)\n\t\t\t\t}\n\t\t\t\tconst {redirect, append} = last.route;\n\t\t\t\ttry {\n\t\t\t\t\tthis.replace(\n\t\t\t\t\t\t`${path}${append ? '/' : '/../'}${redirect}`,\n\t\t\t\t\t\tstate);\n\t\t\t\t\treturn ;\n\t\t\t\t} finally {\n\t\t\t\t\tredirects.pop();\n\t\t\t\t}\n\t\t\t}\n\t\t\tconst nodes = this._nodes;\n\t\t\tconst nodesLength = nodes.length;\n\t\t\tconst matchesLength = matches.length;\n\t\t\tconst min = Math.min(matchesLength, nodesLength);\n\t\t\tfor (let i = 0; i < min; i++) { nodes[i](matches[i]); }\n\t\t\tfor (let i = min; i < nodesLength; i++) {\n\t\t\t\tnodes[i](undefined);\n\t\t\t}\n\t\t\tfor (let i = min; i < matchesLength; i++) {\n\t\t\t\tnodes[i] = Neep.value(matches[i]);\n\t\t\t}\n\t\t\tnodes.length = matchesLength;\n\t\t\tthis._size(matchesLength);\n\t\t\tthis._matches(matches);\n\t\t\tthis._path(path);\n\t\t\tthis._alias(last?.route?.alias || '');\n\t\t\tupdate(this.params, last?.params || {});\n\t\t\tupdate(this.meta, last?.route?.meta || {});\n\t\t}\n\t\tif (this._search() !== search) {\n\t\t\tthis._search(search);\n\t\t\tupdate(this.query, (this.parse || parse)(search.substr(1)));\n\t\t}\n\t\tthis._hash(hash);\n\t\tthis._state(state);\n\t}\n\tpush(location: Location | string, state?: any) {\n\t\tconst { path, search, hash } = get(\n\t\t\tlocation,\n\t\t\tthis._namedRoutes,\n\t\t\tthis._path(),\n\t\t\tthis.stringify,\n\t\t)\n\t\tthis.history?.push(path, search, hash, state);\n\t\tthis._update(path, search, hash, state);\n\t}\n\treplace(location: Location | string, state?: any) {\n\t\tconst {path, search, hash} = get(\n\t\t\tlocation,\n\t\t\tthis._namedRoutes,\n\t\t\tthis._path(),\n\t\t\tthis.stringify,\n\t\t)\n\t\tthis.history?.replace(path, search, hash, state);\n\t\tthis._update(path, search, hash, state);\n\t}\n\tgetUrl(location: Location | string) {\n\t\tconst {path, search, hash} = get(\n\t\t\tlocation,\n\t\t\tthis._namedRoutes,\n\t\t\tthis._path(),\n\t\t\tthis.stringify,\n\t\t)\n\t\treturn `${path}${search}${hash}`\n\n\t}\n\tgo(index: number) {\n\t\tconst it = this.history?.go(index);\n\t\tif (!it) { return; }\n\t\tthis._update(...it);\n\t}\n\tback() {\n\t\tconst it = this.history?.back();\n\t\tif (!it) { return; }\n\t\tthis._update(...it);\n\t}\n\tforward() {\n\t\tconst it = this.history?.forward();\n\t\tif (!it) { return; }\n\t\tthis._update(...it);\n\t}\n\tget view() {\n\t\tconst view: Component = (props, ...p) =>\n\t\t\tRouterView({...props, router: this}, ...p);\n\t\tNeep.mName('Router', view);\n\t\tReflect.defineProperty(this, 'view', {\n\t\t\tvalue: view,\n\t\t\tenumerable: true,\n\t\t\tconfigurable: true,\n\t\t})\n\t\treturn view;\n\t}\n}\n\nexport default Router;","import * as Neep from '@neep/core';\nimport Router from '.';\n\nRouter.install(Neep);\nexport { default } from '.';\n"],"names":["contextConstructor","context","router","delivered","__NeepRouter__","depth","__RouteDepth__","Reflect","defineProperty","value","enumerable","configurable","get","_get","Neep","install","neep","addContextConstructor","RouterView","props","createElement","Deliver","label","isNew","Router","Number","isInteger","size","match","route","components","name","component","undefined","path","mSimple","mName","RouterLink","auxiliary","childNodes","to","append","replace","search","hash","query","alias","params","onclick","push","history","link","cleanPath","test","addRoute","cfg","named","parent","children","meta","p","end","Array","isArray","length","default","item","toPath","compile","encode","encodeURIComponent","decode","decodeURIComponent","map","c","matchRoutes","routes","result","redirect","getValue","v","isFinite","String","stringify","s","list","key","Object","keys","k","val","join","parse","create","set","it","split","index","indexOf","substr","StoreHistory","constructor","state","go","newIndex","back","forward","onClick","WebPathHistory","opt","base","f","_update","getPath","location","window","addEventListener","destroy","removeEventListener","start","pushState","replaceState","pathname","old","href","getUrl","e","preventDefault","exec","oldHash","basePath","stringifyQuery","routePath","update","obj","newKeys","Set","ownKeys","has","redirects","View","Link","_size","matches","_matches","_alias","_path","_search","_hash","_state","History","historyOption","encase","setRoutes","_routes","_namedRoutes","_nodes","force","last","Error","pop","nodes","nodesLength","matchesLength","min","Math","i","view"],"mappings":"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"}